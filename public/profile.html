<!DOCTYPE html>
<html lang="en">
  <!-- [Head] start -->
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Blaze</title>
    
    <!-- Theme Settings Remover - Add at the very beginning -->
    <script src="js/hide-theme-settings.js"></script>
    
    <!-- [Favicon] icon -->
    <link rel="icon" href="../assets/images/favicon.svg" type="image/x-icon">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <!-- [Font] Family -->
    <link rel="stylesheet" href="../assets/fonts/inter/inter.css" id="main-font-link" />
    <link rel="stylesheet" href="../assets/css/plugins/datepicker-bs5.min.css">

    <!-- [Tabler Icons] https://tablericons.com -->
    <link rel="stylesheet" href="../assets/fonts/tabler-icons.min.css" />
    <!-- [Feather Icons] https://feathericons.com -->
    <link rel="stylesheet" href="../assets/fonts/feather.css" />
    <!-- [Font Awesome Icons] https://fontawesome.com/icons -->
    <link rel="stylesheet" href="../assets/fonts/fontawesome.css" />
    <!-- [Material Icons] https://fonts.google.com/icons -->
    <link rel="stylesheet" href="../assets/fonts/material.css" />
    <!-- [Template CSS Files] -->
    <link rel="stylesheet" href="../assets/css/style.css" id="main-style-link" />
    <link rel="stylesheet" href="../assets/css/style-preset.css" />
    <!-- [Choices CSS] -->
    <link rel="stylesheet" href="../assets/css/plugins/select.bootstrap5.min.css" />
    <!-- [Datepicker CSS] -->
    <link rel="stylesheet" href="../assets/css/plugins/datepicker-bs5.min.css" />
    
    <!-- Choices CSS -->
    <link rel="stylesheet" href="../assets/css/plugins/select.bootstrap5.min.css">
    
    <!-- Datepicker CSS -->
    <link rel="stylesheet" href="../assets/css/plugins/datepicker-bs5.min.css">

    <!-- Add major sub-category CSS -->
    <link rel="stylesheet" href="css/major-subcategory.css">

    <style>
        .input-group {
            margin-bottom: 1rem;
        }
        
        /* Add styles for readonly inputs */
        input[readonly] {
            background-color: #f8f9fa !important;
            cursor: not-allowed;
            opacity: 1 !important;
        }

        /* Ensure readonly inputs show their values clearly */
        input[readonly]:not([value=""]) {
            color: #212529 !important;
        }
        
        .remove-field {
            padding: 0.375rem 0.75rem;
        }
        
        #addPlatform {
            margin-top: 1rem;
        }
        
        /* Choices specific styles */
        .choices__inner {
            border-radius: 0.375rem;
            background-color: #fff;
            border: 1px solid #ced4da;
        }
        
        .choices__input {
            background-color: transparent;
        }
        
        .choices__list--dropdown {
            background-color: #fff;
            border: 1px solid #ced4da;
        }
        
        .choices__list--dropdown .choices__item {
            color: #212529;
        }
        
        .choices__list--dropdown .choices__item--selectable.is-highlighted {
            background-color: #0d6efd;
            color: #fff;
        }

        .choices__list--multiple .choices__item {
            background-color: #0d6efd;
            border: 1px solid #0d6efd;
            color: #fff;
        }

        .choices__list--multiple .choices__item.is-highlighted {
            background-color: #0d6efd;
            border: 1px solid #0d6efd;
            color: #fff;
        }

        .img-container {
            height: 50vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f9fa;
            padding: 1rem;
            overflow: hidden;
        }
        #imageToCrop {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .cropper-view-box, .cropper-face {
            border-radius: 50%;
        }
        .cropper-modal {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .cropper-dashed {
            border-style: dashed;
        }
        .cropper-point {
            background-color: #0d6efd;
        }
        .cropper-line {
            background-color: #0d6efd;
        }

        /* Existing styles ... */
        
        .multi-select-container {
          position: relative;
          width: 100%;
          min-height: 38px;
          border: 1px solid #ced4da;
          border-radius: 0.375rem;
          padding: 0.25rem;
          background: #fff;
          cursor: text;
        }

        .multi-select-container:focus-within {
          border-color: #86b7fe;
          box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        .tags-container {
          display: flex;
          flex-wrap: wrap;
          gap: 0.25rem;
          align-items: center;
          min-height: 24px;
        }

        .industry-tag {
          display: inline-flex;
          align-items: center;
          background: #e9ecef;
          padding: 0.25rem 0.5rem;
          border-radius: 0.25rem;
          font-size: 0.875rem;
          margin: 2px;
        }

        .industry-tag .remove-tag {
          margin-left: 0.5rem;
          cursor: pointer;
          font-size: 1.2rem;
          line-height: 1;
          color: #6c757d;
        }

        .industry-tag .remove-tag:hover {
          color: #dc3545;
        }

        .industry-input {
          border: none;
          outline: none;
          padding: 0.25rem;
          flex: 1;
          min-width: 120px;
          font-size: 0.875rem;
        }

        .industry-dropdown {
          position: absolute;
          top: 100%;
          left: 0;
          right: 0;
          background: white;
          border: 1px solid rgba(0,0,0,0.15);
          border-radius: 0.375rem;
          box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
          max-height: 200px;
          overflow-y: auto;
          z-index: 1000;
          display: none;
        }

        .industry-option {
          padding: 0.5rem 1rem;
          cursor: pointer;
        }

        .industry-option:hover {
          background-color: #f8f9fa;
        }
    </style>
  </head>
  <!-- [Head] end -->
  <!-- [Body] Start -->
  <body>
    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
      <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
          <strong class="me-auto" id="toast-title">Notification</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toast-message"></div>
      </div>
    </div>

    <!-- [ Pre-loader ] start -->
    <div class="loader-bg">
      <div class="loader-track">
        <div class="loader-fill"></div>
      </div>
    </div>
    <!-- [ Pre-loader ] End -->

    <!-- [ Sidebar Menu ] start -->
    <div id="sidebar-container"></div>
    <!-- [ Sidebar Menu ] end -->

    <!-- [ Header Topbar ] start -->
    <div id="header-container"></div>
    <!-- [ Header Topbar ] end -->

    <!-- [ Main Content ] start -->
    <div class="pc-container">
      <div class="pc-content">
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
          <div class="page-block">
            <div class="row align-items-center">
              <div class="col-md-12">
                <ul class="breadcrumb">
                  <li class="breadcrumb-item"><a href="">Home</a></li>
                  <li class="breadcrumb-item" aria-current="page">Profile</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <!-- [ breadcrumb ] end -->

        <!-- [ Main Content ] start -->
        <div class="row">
          <!-- [ sample-page ] start -->
          <div class="col-sm-12">
            <div class="card">
              <div class="card-body py-0">
                <ul class="nav nav-tabs profile-tabs" id="myTab" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="profile-tab-1" data-bs-toggle="tab" href="#profile-1" role="tab" aria-selected="true">
                      <i class="ti ti-user me-2"></i>Profile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="profile-tab-3" data-bs-toggle="tab" href="#profile-3" role="tab" aria-selected="true">
                      <i class="ti ti-id me-2"></i>Edit Details
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="profile-tab-4" data-bs-toggle="tab" href="#profile-4" role="tab" aria-selected="true">
                      <i class="ti ti-lock me-2"></i>Change Password
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="profile-tab-6" data-bs-toggle="tab" href="#profile-6" role="tab" aria-selected="true">
                      <i class="ti ti-settings me-2"></i>Settings
                    </a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="tab-content">
              <!-- Profile Tab Content -->
              <div class="tab-pane show active" id="profile-1" role="tabpanel" aria-labelledby="profile-tab-1">
                <div class="row">
                  <div class="col-lg-4 col-xxl-3">
                    <div class="card">
                      <div class="card-body position-relative">
                        <div class="text-center mt-3">
                          <div class="chat-avtar d-inline-flex mx-auto">
                            <img class="rounded-circle img-fluid wid-70" id="profile-picture" src="" alt="User image" style="display: block;">
                          </div>
                          <h5 class="mb-0" id="full-name"></h5>
                          <p class="text-muted text-sm" id="year-of-study"></p>
                          <hr class="my-3 border border-secondary-subtle">
                          <hr class="my-3 border border-secondary-subtle">
                          <div class="d-inline-flex align-items-center justify-content-start w-100 mb-3">
                            <i class="ti ti-mail me-2"></i>
                            <p class="mb-0" id="email"></p>
                          </div>
                          <div class="d-inline-flex align-items-center justify-content-start w-100 mb-3">
                            <i class="ti ti-phone me-2"></i>
                            <p class="mb-0" id="phone"></p>
                          </div>
                          <div class="d-inline-flex align-items-center justify-content-start w-100 mb-3">
                            <i class="ti ti-map-pin me-2"></i>
                            <p class="mb-0" id="location"></p>
                          </div>
                          <hr class="my-3 border border-secondary-subtle">
                          <div class="text-center">
                            <p class="text-muted mb-2">Social Media</p>
                            <div id="social-links" class="d-flex flex-wrap justify-content-center"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="card">
                      <div class="card-header d-inline-flex align-items-center justify-content-space-between">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <h5 style="margin-left:15px;">No of Co-Founders: <span id="co-founders-count">0</span></h5>
                      </div>
                    </div>
                    <div class="card">
                      <div class="card-header">
                        <h5>Resume</h5>
                      </div>
                      <div class="card-body">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#resumeModal">
                          <i class="ti ti-file-text me-2"></i>View Resume
                        </button>
                      </div>
                    </div>
                    <div class="card">
                      <div class="card-header">
                        <h5>Skills</h5>
                      </div>
                      <div class="card-body">
                        <div class="row align-items-center mb-3">
                                    <p class="mb-1 text-muted">Technical Skills</p>
                          <div class="col-sm-12 mb-2 mb-sm-0">
                            <p class="mb-0" id="hard-skills"></p>
                          </div>
                        </div>
                        <div class="row align-items-center mb-3">
                          <p class="mb-1 text-muted">Soft Skills</p>
                          <div class="col-sm-12 mb-2 mb-sm-0">
                            <p class="mb-0" id="soft-skills"></p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-8 col-xxl-9">
                    <div class="card">
                      <div class="card-header">
                        <h5>About me</h5>
                      </div>
                      <div class="card-body">
                        <p class="mb-0" id="about-me"></p>
                      </div>
                    </div>
                    <div class="card">
                      <div class="card-header">
                        <h5>Personal Details</h5>
                      </div>
                      <div class="card-body">
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item px-0 pt-0">
                            <div class="row">
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Full Name</p>
                                <p class="mb-0" id="personal-full-name"></p>
                              </div>
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Username</p>
                                <p class="mb-0" id="username"></p>
                              </div>
                            </div>
                          </li>
                          <li class="list-group-item px-0">
                            <div class="row">
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Date of Birth</p>
                                <p class="mb-0" id="date-of-birth"></p>
                              </div>
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Gender</p>
                                <p class="mb-0" id="gender"></p>
                              </div>
                            </div>
                          </li>
                          <li class="list-group-item px-0">
                            <div class="row">
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">State</p>
                                <p class="mb-0" id="state"></p>
                              </div>
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">City</p>
                                <p class="mb-0" id="city"></p>
                              </div>
                            </div>
                          </li>
                          <li class="list-group-item px-0">
                            <div class="row">
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Zip Code</p>
                                <p class="mb-0" id="zip-code"></p>
                              </div>
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Address</p>
                                <p class="mb-0" id="address"></p>
                              </div>
                            </div>
                          </li>
                          <li class="list-group-item px-0">
                            <div class="row">
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Pronouns</p>
                                <p class="mb-0" id="pronouns"></p>
                              </div>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>
                    <div class="card">
                      <div class="card-header">
                        <h5>Education</h5>
                      </div>
                      <div class="card-body">
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item px-0 pt-0">
                            <div class="row">
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Year of Study</p>
                                <p class="mb-0" id="education-year"></p>
                              </div>
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Institute</p>
                                <p class="mb-0" id="institute"></p>
                              </div>
                            </div>
                          </li>
                          <li class="list-group-item px-0 pb-0">
                            <div class="row">
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Area of Study</p>
                                                <p class="mb-0" id="major"></p>
                              </div>
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Major Type</p>
                                <p class="mb-0" id="major-type"></p>
                              </div>
                            </div>
                          </li>
                          <li class="list-group-item px-0 pb-0">
                            <div class="row">
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Major</p>
                                                <p class="mb-0" id="major-sub-category"></p>
                              </div>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>
                    <div class="card">
                      <div class="card-header">
                        <h5>Interest/industry</h5>
                      </div>
                      <div class="card-body">
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item px-0 pt-0">
                            <div class="row">
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">My Interests</p>
                                <p class="mb-0" id="my-interests"></p>
                              </div>
                              <div class="col-md-6">
                                <p class="mb-1 text-muted">Looking for specific interest</p>
                                <p class="mb-0" id="looking-for-interests"></p>
                              </div>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Edit Details Tab Content -->
              <div class="tab-pane" id="profile-3" role="tabpanel" aria-labelledby="profile-tab-3">
                <form id="editProfileForm" enctype="multipart/form-data">
                  <div class="card">
                    <div class="card-header">
                      <h5>Personal Details</h5>
                    </div>
                    <div class="card-body">
                      <div class="row">
                        <!-- Personal Information -->
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Username</label>
                          <input type="text" class="form-control" name="username" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Full Name</label>
                          <input type="text" class="form-control" name="fullName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Email</label>
                          <input type="email" class="form-control" name="email" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Phone Number</label>
                          <input type="tel" class="form-control" name="phone" required>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Date of Birth</label>
                          <input type="date" class="form-control" name="dateOfBirth">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Gender</label>
                          <select class="form-select" name="gender">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                            <option value="Prefer not to say">Prefer not to say</option>
                          </select>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Pronouns</label>
                          <select class="form-select" name="pronouns">
                            <option value="">Select Pronouns</option>
                            <option value="He/Him">He/Him</option>
                            <option value="She/Her">She/Her</option>
                            <option value="They/Them">They/Them</option>
                            <option value="Other">Other</option>
                            <option value="Prefer not to say">Prefer not to say</option>
                          </select>
                        </div>
                        <div class="col-md-12 mb-3">
                          <label class="form-label">Bio</label>
                          <textarea class="form-control" name="bio" rows="4" placeholder="Tell us about yourself..."></textarea>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Profile Picture</label>
                          <input type="file" class="form-control" name="profilePicture" accept="image/*" id="profilePictureInput">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Resume</label>
                          <input type="file" class="form-control" name="resume" accept=".pdf,.doc,.docx" id="resumeInput">
                          <small class="text-muted">Accepted formats: PDF, DOC, DOCX</small>
                          <small id="resumeStatus" class="ms-2"></small>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Educational Details Card -->
                  <div class="card mt-3">
                    <div class="card-header">
                      <h5>Educational Details</h5>
                    </div>
                    <div class="card-body">
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label for="yearOfStudy" class="form-label">Year of Study</label>
                            <select class="form-select" id="yearOfStudy" name="yearOfStudy">
                              <option value="">Select Year of Study</option>
                              <option value="Freshman">Freshman</option>
                              <option value="Sophomore">Sophomore</option>
                              <option value="Junior">Junior</option>
                              <option value="Senior">Senior</option>
                              <option value="Graduate">Graduate</option>
                              <option value="Post Graduate">Post Graduate</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label for="institution" class="form-label">Institution</label>
                            <input type="text" class="form-control" id="institution" name="institution" placeholder="Search for your institution">
                            <div id="institutionSuggestions" class="list-group position-absolute w-100" style="display: none; z-index: 1000;"></div>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label for="major-select" class="form-label">Area of Study</label>
                            <select class="form-select" id="major-select" name="major_category">
                              <option value="">Select Area of Study</option>
                              <option value="Engineering">Engineering</option>
                              <option value="Science">Science</option>
                              <option value="Business">Business</option>
                              <option value="Arts">Arts</option>
                              <option value="Other">Other</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label for="major-sub-category-container" class="form-label">Major</label>
                            <div id="major-sub-category-container"></div>
                            <input type="hidden" id="major-sub-category-input" name="major_sub_category">
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12">
                          <div class="mb-3">
                            <label for="major-type-select" class="form-label">Major Type</label>
                            <select class="form-select" id="major-type-select" name="major_type">
                              <option value="">Select Major Type</option>
                              <option value="technical">Technical</option>
                              <option value="non-technical">Non-Technical</option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Industry and Skills Card -->
                  <div class="card mt-3">
                    <div class="card-header">
                      <h5>Industry and Skills</h5>
                    </div>
                    <div class="card-body">
                      <div class="row">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="industry-input" class="form-label">My Industry</label>
                            <div class="multi-select-container" id="industry-multi-select">
                              <div class="tags-container" id="industry-tags-container">
                                <input type="text" class="industry-input" id="industry-input" placeholder="Type or select industries">
                              </div>
                              <div class="industry-dropdown" id="industry-dropdown"></div>
                            </div>
                            <input type="hidden" name="my_interests" id="industry-hidden-input">
                            <small class="form-text text-muted">Type to search or add custom industries. Press Enter or comma to add.</small>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="looking-for-input" class="form-label">Looking for specific interest</label>
                            <div class="multi-select-container" id="looking-for-multi-select">
                              <div class="tags-container" id="looking-for-tags-container">
                                <input type="text" class="industry-input" id="looking-for-input" placeholder="Type or select interests">
                      </div>
                              <div class="industry-dropdown" id="looking-for-dropdown"></div>
                            </div>
                            <input type="hidden" name="interests_looking_in_others" id="looking-for-hidden-input">
                            <small class="form-text text-muted">Type to search or add custom interests. Press Enter or comma to add.</small>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="co-founders-looking-for" class="form-label">Number of Co-Founders Looking For</label>
                            <input type="number" class="form-control" id="co-founders-looking-for" name="co_founders_looking_for" min="1" max="10" placeholder="Enter number">
                            <small class="form-text text-muted">How many co-founders are you looking for?</small>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Technical & Soft Skills Card -->
                  <div class="card mt-3">
                    <div class="card-header">
                      <h5>Technical & Soft Skills</h5>
                    </div>
                    <div class="card-body">
                      <div class="row">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="technical-skills-input" class="form-label">Technical Skills</label>
                            <div class="multi-select-container" id="technical-skills-multi-select">
                              <div class="tags-container" id="technical-skills-tags-container">
                                <input type="text" class="industry-input" id="technical-skills-input" placeholder="Type or select technical skills">
                              </div>
                              <div class="industry-dropdown" id="technical-skills-dropdown"></div>
                            </div>
                            <input type="hidden" name="technical_skills" id="technical-skills-hidden-input">
                            <small class="form-text text-muted">Type to search or add custom technical skills. Press Enter or comma to add.</small>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="soft-skills-input" class="form-label">Soft Skills</label>
                            <div class="multi-select-container" id="soft-skills-multi-select">
                              <div class="tags-container" id="soft-skills-tags-container">
                                <input type="text" class="industry-input" id="soft-skills-input" placeholder="Type or select soft skills">
                              </div>
                              <div class="industry-dropdown" id="soft-skills-dropdown"></div>
                            </div>
                            <input type="hidden" name="soft_skills" id="soft-skills-hidden-input">
                            <small class="form-text text-muted">Type to search or add custom soft skills. Press Enter or comma to add.</small>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Address Card -->
                  <div class="card mt-3">
                    <div class="card-header">
                      <h5>Address</h5>
                    </div>
                    <div class="card-body">
                      <div class="row">
                        <div class="col-md-4">
                          <div class="mb-3">
                            <label for="zipCode" class="form-label">ZIP Code</label>
                            <input type="text" class="form-control" id="zipCode" name="zipCode" maxlength="5" pattern="[0-9]{5}" placeholder="Enter ZIP code">
                            <small class="form-text text-muted">Enter a 5-digit ZIP code</small>
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="mb-3">
                            <label for="state" class="form-label">State</label>
                            <input type="text" class="form-control" id="state" name="state" readonly>
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="mb-3">
                            <label for="city" class="form-label">City</label>
                            <input type="text" class="form-control" id="city" name="city" readonly>
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div class="mb-3">
                            <label for="address" class="form-label">Address</label>
                            <textarea class="form-control" id="address" name="address" rows="3" placeholder="Enter your complete address"></textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Social Media Links Card -->
                  <div class="card mt-3">
                    <div class="card-header">
                      <h5>Social Media Links</h5>
                    </div>
                    <div class="card-body">
                      <p class="text-muted mb-3">Add your social media platforms to connect with others. Select a platform and enter the full URL including https://.</p>
                      <div id="platformsContainer"></div>
                      <button type="button" class="btn btn-primary mt-2" id="addPlatform">Add Platform</button>
                    </div>
                  </div>

                  <!-- Update Details Button -->
                  <div class="text-end mt-3">
                    <button type="submit" class="btn btn-primary">Update Details</button>
                  </div>
                </form>
              </div>
              <!-- Change Password Tab Content -->
              <div class="tab-pane" id="profile-4" role="tabpanel" aria-labelledby="profile-tab-4">
                <div class="card">
                  <div class="card-header">
                    <h5>Change Password</h5>
                  </div>
                  <div class="card-body">
                    <form id="profileChangePasswordForm">
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="form-group mb-3">
                            <label class="form-label">Current Password</label>
                            <div class="input-group">
                              <input type="password" class="form-control" id="profileOldPassword" required>
                              <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('profileOldPassword')">
                                <i class="ti ti-eye" id="profileOldPasswordIcon"></i>
                              </button>
                            </div>
                            <div class="invalid-feedback" id="currentPassword-feedback"></div>
                          </div>
                          <div class="form-group mb-3">
                            <label class="form-label">New Password</label>
                            <div class="input-group">
                              <input type="password" class="form-control" id="profileNewPassword" required>
                              <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('profileNewPassword')">
                                <i class="ti ti-eye" id="profileNewPasswordIcon"></i>
                              </button>
                            </div>
                            <div class="password-strength mt-2">
                              <div class="progress mb-2" style="height: 5px;">
                                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
                              </div>
                              <div class="requirements">
                                <p class="requirement mb-1" data-requirement="length">
                                  <i class="ti ti-circle text-muted"></i> At least 8 characters
                                </p>
                                <p class="requirement mb-1" data-requirement="uppercase">
                                  <i class="ti ti-circle text-muted"></i> At least one uppercase letter
                                </p>
                                <p class="requirement mb-1" data-requirement="lowercase">
                                  <i class="ti ti-circle text-muted"></i> At least one lowercase letter
                                </p>
                                <p class="requirement mb-1" data-requirement="number">
                                  <i class="ti ti-circle text-muted"></i> At least one number
                                </p>
                                <p class="requirement mb-1" data-requirement="special">
                                  <i class="ti ti-circle text-muted"></i> At least one special character
                                </p>
                              </div>
                            </div>
                          </div>
                          <div class="form-group mb-3">
                            <label class="form-label">Confirm Password</label>
                            <div class="input-group">
                              <input type="password" class="form-control" id="profileConfirmPassword" required>
                              <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('profileConfirmPassword')">
                                <i class="ti ti-eye" id="profileConfirmPasswordIcon"></i>
                              </button>
                            </div>
                            <div class="invalid-feedback" id="confirmPassword-feedback"></div>
                          </div>
                          <div id="profilePasswordError" class="alert alert-danger mb-3" style="display: none;"></div>
                        </div>
                      </div>
                      <div class="card-footer text-end btn-page">
                        <button type="button" class="btn btn-outline-secondary" id="cancelPasswordChange">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="updatePasswordBtn">
                          <span class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></span>
                          Update Password
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <!-- Settings Tab Content -->
              <div class="tab-pane" id="profile-6" role="tabpanel" aria-labelledby="profile-tab-6">
                <div class="row">
                  <div class="col-md-12">
                    <div class="card">
                      <div class="card-header">
                        <h5>Privacy Settings</h5>
                      </div>
                      <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between mb-1">
                          <div>
                            <p class="text-muted mb-0">Private Mode</p>
                            <small class="text-muted">When enabled, your profile won't be suggested to other users.</small>
                          </div>
                          <div class="form-check form-switch p-0">
                            <input id="privateMode" class="m-0 form-check-input h5 position-relative" type="checkbox" role="switch">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 text-end btn-page">
                    <button type="button" id="cancelPrivacyBtn" class="btn btn-outline-secondary">Cancel</button>
                    <button type="button" id="updatePrivacyBtn" class="btn btn-primary">Update Privacy Setting</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- [ sample-page ] end -->
        </div>
        <!-- [ Main Content ] end -->
      </div>
    </div>
    <!-- [ Main Content ] end -->

    <footer class="pc-footer">
      <div class="footer-wrapper container-fluid">
        <div class="row">
          <div class="col my-1">
            <p class="m-0">Â©2025 Blaze Inc<a href="#" target="_blank"></a></p>
          </div>
          <div class="col-auto my-1">
            <ul class="list-inline footer-link mb-0">
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <div class="pct-c-btn">
      <a href="#" data-bs-toggle="offcanvas" data-bs-target="#offcanvas_pc_layout">
        <svg class="pc-icon">
          <use xlink:href="#custom-setting-2"></use>
        </svg>
      </a>
    </div>

    <div class="offcanvas border-0 pct-offcanvas offcanvas-end" tabindex="-1" id="offcanvas_pc_layout">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">Settings</h5>
        <button type="button" class="btn btn-icon btn-link-danger" data-bs-dismiss="offcanvas" aria-label="Close">
          <i class="ti ti-x"></i>
        </button>
      </div>
      <div class="pct-body" style="height: calc(100% - 85px)">
        <div class="offcanvas-body py-0">
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <div class="pc-dark">
                <h6 class="mb-1">Theme Mode</h6>
                <p class="text-muted text-sm">Choose light or dark mode or Auto</p>
                <div class="row theme-layout">
                  <div class="col-4">
                    <div class="d-grid">
                      <button class="preset-btn btn active" data-value="true" onclick="layout_change('light');">
                        <svg class="pc-icon text-warning">
                          <use xlink:href="#custom-sun-1"></use>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="d-grid">
                      <button class="preset-btn btn" data-value="false" onclick="layout_change('dark');">
                        <svg class="pc-icon">
                          <use xlink:href="#custom-moon"></use>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="d-grid">
                      <button class="preset-btn btn" data-value="default" onclick="layout_change_default();">
                        <svg class="pc-icon">
                          <use xlink:href="#custom-setting-2"></use>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="list-group-item">
              <h6 class="mb-1">Theme Contrast</h6>
              <p class="text-muted text-sm">Choose theme contrast</p>
              <div class="row theme-contrast">
                <div class="col-6">
                  <div class="d-grid">
                    <button class="preset-btn btn" data-value="true" onclick="layout_sidebar_change('true');">
                      <svg class="pc-icon">
                        <use xlink:href="#custom-mask"></use>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="col-6">
                  <div class="d-grid">
                    <button class="preset-btn btn active" data-value="false" onclick="layout_sidebar_change('false');">
                      <svg class="pc-icon">
                        <use xlink:href="#custom-mask-1-outline"></use>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            </li>
            <li class="list-group-item">
              <h6 class="mb-1">Custom Theme</h6>
              <p class="text-muted text-sm">Choose your Primary color</p>
              <div class="theme-color preset-color">
                <a href="#!" class="active" data-value="preset-1"><i class="ti ti-check"></i></a>
                <a href="#!" data-value="preset-2"><i class="ti ti-check"></i></a>
                <a href="#!" data-value="preset-3"><i class="ti ti-check"></i></a>
                <a href="#!" data-value="preset-4"><i class="ti ti-check"></i></a>
                <a href="#!" data-value="preset-5"><i class="ti ti-check"></i></a>
                <a href="#!" data-value="preset-6"><i class="ti ti-check"></i></a>
                <a href="#!" data-value="preset-7"><i class="ti ti-check"></i></a>
                <a href="#!" data-value="preset-8"><i class="ti ti-check"></i></a>
                <a href="#!" data-value="preset-9"><i class="ti ti-check"></i></a>
                <a href="#!" data-value="preset-10"><i class="ti ti-check"></i></a>
              </div>
            </li>
            <li class="list-group-item">
              <h6 class="mb-1">Sidebar Caption</h6>
              <p class="text-muted text-sm">Sidebar Caption Hide/Show</p>
              <div class="row theme-nav-caption">
                <div class="col-6">
                  <div class="d-grid">
                    <button class="preset-btn btn active" data-value="true" onclick="layout_caption_change('true');">
                      <img src="../assets/images/customizer/img-caption-1.svg" alt="img" class="img-fluid" width="70%" />
                    </button>
                  </div>
                </div>
                <div class="col-6">
                  <div class="d-grid">
                    <button class="preset-btn btn" data-value="false" onclick="layout_caption_change('false');">
                      <img src="../assets/images/customizer/img-caption-2.svg" alt="img" class="img-fluid" width="70%" />
                    </button>
                  </div>
                </div>
              </div>
            </li>
            <li class="list-group-item">
              <div class="pc-rtl">
                <h6 class="mb-1">Theme Layout</h6>
                <p class="text-muted text-sm">LTR/RTL</p>
                <div class="row theme-direction">
                  <div class="col-6">
                    <div class="d-grid">
                      <button class="preset-btn btn active" data-value="false" onclick="layout_rtl_change('false');">
                        <img src="../assets/images/customizer/img-layout-1.svg" alt="img" class="img-fluid" width="70%" />
                      </button>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="d-grid">
                      <button class="preset-btn btn" data-value="true" onclick="layout_rtl_change('true');">
                        <img src="../assets/images/customizer/img-layout-2.svg" alt="img" class="img-fluid" width="70%" />
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="list-group-item">
              <div class="pc-container-width">
                <h6 class="mb-1">Layout Width</h6>
                <p class="text-muted text-sm">Choose Full or Container Layout</p>
                <div class="row theme-container">
                  <div class="col-6">
                    <div class="d-grid">
                      <button class="preset-btn btn active" data-value="false" onclick="change_box_container('false')">
                        <img src="../assets/images/customizer/img-container-1.svg" alt="img" class="img-fluid" width="70%" />
                      </button>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="d-grid">
                      <button class="preset-btn btn" data-value="true" onclick="change_box_container('true')">
                        <img src="../assets/images/customizer/img-container-2.svg" alt="img" class="img-fluid" width="70%" />
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="list-group-item">
              <div class="d-grid">
                <button class="btn btn-light-danger" id="layoutreset">Reset Layout</button>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Resume Modal -->
    <div class="modal fade" id="resumeModal" tabindex="-1" aria-labelledby="resumeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="resumeModalLabel">Resume</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-0">
            <div id="resumeContent" class="h-100">
              <div class="ratio ratio-16x9 h-100">
                <embed 
                  id="resumeFrame" 
                  class="w-100 h-100" 
                  type="application/pdf"
                  style="border: none;"
                />
              </div>
              <div id="resumeFallback" class="text-center d-none p-4">
                <i class="ti ti-file-text mb-3" style="font-size: 3rem;"></i>
                <p class="mb-0">This file type cannot be previewed. Please download the file to view it.</p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <a href="#" id="downloadResume" class="btn btn-primary" download>
              <i class="ti ti-download me-2"></i>Download Resume
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Picture Crop Modal -->
    <div class="modal fade" id="cropModal" tabindex="-1" aria-labelledby="cropModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="cropModalLabel">Crop Profile Picture</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-0">
            <div class="img-container">
              <img id="imageToCrop" src="" alt="Profile picture to crop">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="cropImage">Crop & Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Include theme settings -->
    <div id="theme-settings-container"></div>

    <!-- Required Js -->
    <script src="../assets/js/plugins/popper.min.js"></script>
    <script src="../assets/js/plugins/simplebar.min.js"></script>
    <script src="../assets/js/plugins/bootstrap.min.js"></script>
    <script src="../assets/js/fonts/custom-font.js"></script>
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/pcoded.js"></script>
    <script src="../assets/js/plugins/feather.min.js"></script>
    <!-- Choices JS -->
    <script src="../assets/js/plugins/choices.min.js"></script>
    <!-- Cropper JS - Directly loaded with fixed versions -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <!-- Auth JS -->
    <script src="../js/auth.js"></script>

    <!-- Sidebar dropdown fix -->
    <script src="../js/sidebar-fix.js"></script>

    <!-- Zip Lookup JS -->
    <script src="../assets/js/zip-lookup.js"></script>

    <!-- Address Handler JS -->
    <script src="js/address-handler.js"></script>

    <!-- Load components -->
    <script src="components/layout.js"></script>

    <!-- Add major sub-category JS -->
    <script src="components/major-subcategory-dropdown.js"></script>

    <!-- Profile Page Specific Script -->
    <script>
      // Toast notification function
      function showToast(message, type = 'info') {
        const toast = document.getElementById('toast');
        const toastTitle = document.getElementById('toast-title');
        const toastMessage = document.getElementById('toast-message');
        
        // Set toast title based on type
        switch(type) {
          case 'success':
            toastTitle.textContent = 'Success';
            toast.classList.add('bg-success', 'text-white');
            break;
          case 'error':
            toastTitle.textContent = 'Error';
            toast.classList.add('bg-danger', 'text-white');
            break;
          default:
            toastTitle.textContent = 'Info';
            toast.classList.add('bg-info', 'text-white');
        }
        
        toastMessage.textContent = message;
        
        // Show the toast
        const bsToast = new bootstrap.Toast(toast, {
          autohide: true,
          delay: 3000
        });
        bsToast.show();
        
        // Remove the type classes after the toast is hidden
        toast.addEventListener('hidden.bs.toast', function() {
          toast.classList.remove('bg-success', 'bg-danger', 'bg-info', 'text-white');
        });
      }

      // Function to update resume modal
      function updateResumeModal(resumeUrl) {
        console.log('Updating resume modal with URL:', resumeUrl);
        
        const resumeFrame = document.getElementById('resumeFrame');
        const downloadResume = document.getElementById('downloadResume');
        const resumeFallback = document.getElementById('resumeFallback');
        
        if (resumeUrl) {
          // Remove any existing base URL and /uploads/ prefix from the resumeUrl
          const cleanResumeUrl = resumeUrl.replace(/^https?:\/\/[^\/]+/, '').replace(/^\/uploads\//, '');
          const fullUrl = `/uploads/${cleanResumeUrl}`;
          console.log('Full resume URL:', fullUrl);
          
          downloadResume.href = fullUrl;
          
          // Check if the file is a PDF
          if (resumeUrl.toLowerCase().endsWith('.pdf')) {
            // Try to load the PDF directly
            const pdfUrl = window.location.origin + fullUrl;
            console.log('Attempting to load PDF from:', pdfUrl);
            
            resumeFrame.src = pdfUrl;
            resumeFrame.style.display = 'block';
            resumeFallback.style.display = 'none';
            
            // Add event listener to check if PDF loaded successfully
            resumeFrame.onload = function() {
              console.log('PDF loaded successfully');
            };
            
            resumeFrame.onerror = function() {
              console.error('Error loading PDF');
              resumeFrame.style.display = 'none';
              resumeFallback.style.display = 'block';
            };
          } else {
            // For non-PDF files, show the fallback message
            console.log('Non-PDF file detected, showing fallback message');
            resumeFrame.style.display = 'none';
            resumeFallback.style.display = 'block';
          }
        } else {
          console.log('No resume URL provided');
          resumeFrame.style.display = 'none';
          resumeFallback.style.display = 'block';
          downloadResume.href = '#';
        }
      }

      // Initialize profile picture cropping
      function initializeProfilePictureCropping() {
        console.log('Initializing profile picture cropping functionality');
        const profilePictureInput = document.getElementById('profilePictureInput');
        
        if (!profilePictureInput) {
          console.error('Profile picture input element not found!');
          return;
        }
        
        profilePictureInput.addEventListener('change', function(e) {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            console.log('File selected:', file.name);
            
            ensureCropperLoaded(file);
          }
        });
        
        // Function to clean up cropper instance
        function cleanupCropper() {
          if (window.currentCropper) {
            window.currentCropper.destroy();
            window.currentCropper = null;
          }
        }
        
        // Function to handle cropper errors gracefully
        function handleCropperError(file) {
          // Ask user if they want to upload without cropping
          if (confirm('Image cropping failed. Would you like to upload the image without cropping?')) {
                // Update the preview directly
                const profilePicture = document.getElementById('profile-picture');
                if (profilePicture) {
            const reader = new FileReader();
            reader.onload = function(e) {
                    profilePicture.src = e.target.result;
                  };
                  reader.readAsDataURL(file);
                }
                
                // Store the file for submission
                window.croppedProfileImage = file;
            showToast('Image uploaded without cropping', 'info');
              }
            }
          }
      
      // Function to ensure Cropper library is loaded and process image
      function ensureCropperLoaded(file) {
        console.log('Checking if Cropper is loaded...');
        
        // Check if Cropper is already defined
        if (typeof Cropper !== 'undefined') {
          console.log('Cropper already loaded, proceeding...');
          processCropperImage(file);
          return;
        }
        
        console.log('Cropper not found, attempting to load it locally...');
        
          try {
          // First load the CSS - use local path instead of CDN to avoid CSP issues
          const cropperCSS = document.createElement('link');
          cropperCSS.rel = 'stylesheet';
          cropperCSS.href = '../assets/css/plugins/cropper.min.css'; // Local path
          document.head.appendChild(cropperCSS);
          
          // Then load the JS - use local path instead of CDN to avoid CSP issues
          const cropperJS = document.createElement('script');
          cropperJS.src = '../assets/js/plugins/cropper.min.js'; // Local path
          
          cropperJS.onload = function() {
            console.log('Cropper.js loaded successfully');
            // Wait a moment to ensure it's initialized
            setTimeout(function() {
              processCropperImage(file);
            }, 100);
          };
          
          cropperJS.onerror = function() {
            console.error('Failed to load Cropper.js');
            // Call handleCropperError instead of undefined callback
            handleCropperError(file);
          };
          
          document.head.appendChild(cropperJS);
        } catch (err) {
          console.error('Error loading Cropper library:', err);
          handleCropperError(file);
        }
      }

      // Function to process image with cropper
      function processCropperImage(file) {
            const reader = new FileReader();
  const profilePictureInput = document.getElementById('profilePictureInput');
            
            reader.onload = function(e) {
    console.log('File loaded into reader successfully');
    
    // Check if we have a valid result from FileReader
    if (!e.target || !e.target.result) {
      console.error('FileReader result is invalid');
      handleCropperError(file);
      return;
    }
    
    // Create a new Image object to ensure it's fully loaded
    const img = new Image();
    img.crossOrigin = "anonymous"; // Handle CORS issues
    
    // Set up load handler before setting src
    img.onload = function() {
      console.log('Image loaded successfully, dimensions:', img.width, 'x', img.height);
      
      // Validate image dimensions
      if (img.width === 0 || img.height === 0) {
        console.error('Image has invalid dimensions:', img.width, 'x', img.height);
        handleCropperError(file);
        return;
      }
      
      // Pre-validate that image can be drawn on a canvas
      try {
        const testCanvas = document.createElement('canvas');
        testCanvas.width = 50;
        testCanvas.height = 50;
        const testCtx = testCanvas.getContext('2d');
        testCtx.drawImage(img, 0, 0, 50, 50);
        console.log('Test canvas created successfully');
      } catch (canvasErr) {
        console.error('Unable to draw image on test canvas:', canvasErr);
        handleCropperError(file);
        return;
      }
      
      // Get reference to image element
      const imageToCrop = document.getElementById('imageToCrop');
      if (!imageToCrop) {
        console.error('Image to crop element not found');
        handleCropperError(file);
        return;
      }
      
      // Set the source to the loaded image
      imageToCrop.src = img.src;
      
      // Make sure imageToCrop has correct dimensions and is loading properly
      if (imageToCrop.complete) {
        console.log('Image is already complete, initializing cropper');
        initializeCropper();
      } else {
        console.log('Waiting for image to load completely');
        imageToCrop.onload = initializeCropper;
        imageToCrop.onerror = function() {
          console.error('Error loading image in the DOM');
          handleCropperError(file);
        };
      }
      
      function initializeCropper() {
        // Check that image has dimensions
        if (!imageToCrop.width || !imageToCrop.height) {
          console.error('Image has no dimensions in the DOM:', imageToCrop.width, 'x', imageToCrop.height);
          handleCropperError(file);
          return;
        }
        
        // Delay initialization to ensure DOM rendering is complete
        setTimeout(() => {
          try {
            // Clean up any existing cropper instance
            if (window.currentCropper) {
              console.log('Destroying existing cropper instance');
              window.currentCropper.destroy();
              window.currentCropper = null;
            }
            
            console.log('Initializing Cropper with fully loaded image');
            
            // Check if Cropper is defined
                    if (typeof Cropper === 'undefined') {
              console.error('Cropper library not available');
              handleCropperError(file);
              return;
                    }
                    
            // Create Cropper instance with more reliable options
                    window.currentCropper = new Cropper(imageToCrop, {
                aspectRatio: 1,
              viewMode: 1,
                dragMode: 'move',
              autoCropArea: 0.65, // Slightly smaller area for better results
                restore: false,
                modal: true,
                guides: true,
                highlight: false,
                cropBoxMovable: true,
                cropBoxResizable: true,
                responsive: true,
              zoomable: true,
              checkCrossOrigin: false,
              checkOrientation: false,
              minCropBoxWidth: 50, // Smaller min size to allow more flexibility
              minCropBoxHeight: 50,
              ready: function() {
                console.log('Cropper is ready');
              }
              });

                    // Show the modal
            const cropModal = new bootstrap.Modal(document.getElementById('cropModal'));
            cropModal.show();

                    // Add event listener to crop button
            setupCropButtonHandler(cropModal);
                    
                    // Clean up when modal is hidden
            const cropModalElement = document.getElementById('cropModal');
            if (cropModalElement) {
              cropModalElement.addEventListener('hidden.bs.modal', function() {
                      if (window.currentCropper) {
                        window.currentCropper.destroy();
                        window.currentCropper = null;
                      }
                    });
                  }
              } catch (err) {
            console.error('Error in cropper initialization:', err);
                handleCropperError(file);
              }
        }, 300); // Longer delay to ensure image is rendered
      }
      
      function setupCropButtonHandler(cropModal) {
        const cropButton = document.getElementById('cropImage');
        if (!cropButton) {
          console.error('Crop button not found');
          return;
        }
        
        // Remove existing listeners by cloning
        const newCropButton = cropButton.cloneNode(true);
        cropButton.parentNode.replaceChild(newCropButton, cropButton);
        
        // Add click listener to the new button
        newCropButton.addEventListener('click', function() {
          console.log('Crop button clicked');
          
          if (!window.currentCropper) {
            console.error('No cropper instance found when trying to crop');
            showToast('Cropping tool not initialized properly', 'error');
            return;
          }
          
          // Use cascading fallbacks for canvas creation
          createCroppedImage(cropModal);
        });
        
        console.log('Crop button handler attached');
      }
      
      function createCroppedImage(cropModal) {
        console.log('Attempting to create cropped canvas...');
        
        // Try high quality first (300x300)
        tryCreateCanvas(300, 300, 'high', 0.95)
          .then(({canvas, blob}) => {
            console.log('Successfully created high quality canvas');
            finalizeCrop(canvas, blob, cropModal);
          })
          .catch(error => {
            console.error('Failed with high quality settings:', error);
            showToast('Trying with medium quality...', 'info');
            
            // Try medium quality (200x200)
            tryCreateCanvas(200, 200, 'medium', 0.9)
              .then(({canvas, blob}) => {
                console.log('Successfully created medium quality canvas');
                finalizeCrop(canvas, blob, cropModal, 'Image cropped with medium quality');
              })
              .catch(error => {
                console.error('Failed with medium quality settings:', error);
                showToast('Trying with low quality...', 'info');
                
                // Try low quality (100x100)
                tryCreateCanvas(100, 100, 'low', 0.8)
                  .then(({canvas, blob}) => {
                    console.log('Successfully created low quality canvas');
                    finalizeCrop(canvas, blob, cropModal, 'Image cropped with low quality');
                  })
                  .catch(error => {
                    console.error('All canvas creation attempts failed:', error);
                    
                    // Last resort: create manual canvas from cropper data
                    try {
                      console.log('Attempting manual canvas creation');
                      const cropData = window.currentCropper.getData();
                      const cropBoxData = window.currentCropper.getCropBoxData();
                      console.log('Crop data:', cropData);
                      console.log('Crop box data:', cropBoxData);
                      
                      const manualCanvas = document.createElement('canvas');
                      manualCanvas.width = 150;
                      manualCanvas.height = 150;
                      const ctx = manualCanvas.getContext('2d');
                      
                      // Draw the image manually based on crop data
                      ctx.drawImage(
                        img,
                        cropData.x,
                        cropData.y,
                        cropData.width,
                        cropData.height,
                        0,
                        0,
                        150,
                        150
                      );
                      
                      manualCanvas.toBlob(function(blob) {
                        if (blob) {
                          console.log('Manual canvas creation successful');
                          finalizeCrop(manualCanvas, blob, cropModal, 'Image cropped with basic quality');
                        } else {
                          handleCropperError(file);
                        }
                      }, 'image/jpeg', 0.7);
                    } catch (manualError) {
                      console.error('Manual canvas creation failed:', manualError);
                      handleCropperError(file);
                    }
                  });
              });
          });
      }
      
      function tryCreateCanvas(width, height, quality, compressionLevel) {
        return new Promise((resolve, reject) => {
          try {
            console.log(`Trying to create ${width}x${height} canvas with ${quality} quality`);
            
            const canvas = window.currentCropper.getCroppedCanvas({
              width: width,
              height: height,
              fillColor: '#fff',
              imageSmoothingEnabled: true,
              imageSmoothingQuality: quality
                  });
            
            if (!canvas) {
              return reject(new Error('Canvas creation returned null'));
            }

                  canvas.toBlob(function(blob) {
              if (blob) {
                resolve({canvas, blob});
              } else {
                reject(new Error('Blob creation failed'));
              }
            }, 'image/jpeg', compressionLevel);
          } catch (err) {
            reject(err);
          }
        });
      }
      
      function finalizeCrop(canvas, blob, cropModal, message = 'Image cropped successfully!') {
        // Store the blob for later use
              window.croppedProfileImage = blob;
        console.log('Created blob:', blob.size, 'bytes');
              
        // Try to update the file input
              try {
                    const dataTransfer = new DataTransfer();
          const fileName = 'profile-' + Date.now() + '.jpg';
          const newFile = new File([blob], fileName, { type: 'image/jpeg' });
          dataTransfer.items.add(newFile);
                    profilePictureInput.files = dataTransfer.files;
        } catch(e) {
          console.warn('DataTransfer API failed:', e);
              }
                    
        // Update the preview image
        const profilePicture = document.getElementById('profile-picture');
        if (profilePicture) {
          profilePicture.src = canvas.toDataURL('image/jpeg', 0.9);
                    }
              
        // Success message
        showToast(message, message.includes('success') ? 'success' : 'info');
                    
        // Hide modal
        try {
          cropModal.hide();
        } catch(e) {
          console.warn('Error hiding modal:', e);
          // Try alternative modal closing
          const modalElement = document.getElementById('cropModal');
          if (modalElement && bootstrap && bootstrap.Modal) {
            const bsModal = bootstrap.Modal.getInstance(modalElement);
            if (bsModal) bsModal.hide();
          }
              }
                    
        // Clean up cropper
              if (window.currentCropper) {
                window.currentCropper.destroy();
                window.currentCropper = null;
              }
      }
    };
    
    // Set error handler for image loading
    img.onerror = function(err) {
      console.error('Error loading image:', err);
      handleCropperError(file);
    };
    
    // Set the image source from the FileReader result
    console.log('Setting image source');
    img.src = e.target.result;
  };
  
  reader.onerror = function(err) {
    console.error('Error reading file:', err);
    handleCropperError(file);
  };
  
  // Read the file as data URL
  console.log('Reading file:', file.name, file.type, file.size, 'bytes');
  reader.readAsDataURL(file);
        }
        
        // Function to handle cropper errors gracefully
        function handleCropperError(file) {
        console.log('Handling cropper error for file:', file.name);
          // Ask user if they want to upload without cropping
          if (confirm('Image cropping failed. Would you like to upload the image without cropping?')) {
            // Update the preview directly
            const profilePicture = document.getElementById('profile-picture');
            if (profilePicture) {
              const reader = new FileReader();
              reader.onload = function(e) {
                profilePicture.src = e.target.result;
              };
              reader.readAsDataURL(file);
            }
            
            // Store the file for submission
            window.croppedProfileImage = file;
          showToast('Image uploaded without cropping', 'info');
          
          // Close the modal if it's open
          const cropModal = document.getElementById('cropModal');
          if (cropModal && typeof bootstrap !== 'undefined') {
            const bsModal = bootstrap.Modal.getInstance(cropModal);
            if (bsModal) {
              bsModal.hide();
            }
          }
        }
      }

      // Initialize when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize profile picture cropping directly
        initializeProfilePictureCropping();
        
        // Also make sure form submission handles the cropped image
        const profileForm = document.getElementById('editProfileForm');
        if (profileForm) {
          const originalSubmit = profileForm.onsubmit;
          profileForm.onsubmit = function(e) {
            // If we have a cropped image stored, make sure it gets submitted
            if (window.croppedProfileImage) {
              console.log('Using stored cropped image for submission');
          }
            // Call the original submit handler
            if (originalSubmit) {
              return originalSubmit.call(this, e);
      }
          };
        }
      });

      // Initialize when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize profile picture cropping
        initializeProfilePictureCropping();

        // Initialize the private mode switch as off by default (if not already set)
        const privateModeSwitch = document.getElementById('privateMode');
        if (privateModeSwitch) {
          privateModeSwitch.checked = false; // Default is off
        }

        console.log('DOM Content Loaded');
        
        // Initialize Choices for all fields except institute
        const textInputs = [
          'choices-text-remove-button-major',
          'choices-text-remove-button-majorsub',
          'choices-text-remove-button-myindustry',
          'choices-text-remove-button-lookingfor',
          'choices-text-remove-button-hardskills',
          'choices-text-remove-button-softskills'
        ];

        textInputs.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
                console.log(`Initializing Choices for ${id}`);
            new Choices(element, {
              removeItemButton: true,
              searchEnabled: true,
              searchPlaceholderValue: 'Search...',
              placeholder: true,
              placeholderValue: 'Type and press enter',
              delimiter: ',',
              editItems: true,
              addItems: true,
              duplicateItemsAllowed: false,
              shouldSort: false
            });
            } else {
                console.warn(`Element with id ${id} not found`);
            }
        });

        // Initialize hard skills select
        const hardSkillsSelect = document.getElementById('hard-skills-select');
        if (hardSkillsSelect) {
            console.log('Initializing hard skills select');
            new Choices(hardSkillsSelect, {
                removeItemButton: true,
                searchEnabled: true,
                searchPlaceholderValue: 'Type to search or add custom skill',
                placeholder: true,
                placeholderValue: 'Select or type to add skills',
                delimiter: ',',
                editItems: true,
                addItems: true,
                duplicateItemsAllowed: false,
                shouldSort: false
            });
        } else {
            console.warn('Hard skills select element not found');
        }

        // Initialize soft skills select
        const softSkillsSelect = document.getElementById('soft-skills-select');
        if (softSkillsSelect) {
            console.log('Initializing soft skills select');
            new Choices(softSkillsSelect, {
                removeItemButton: true,
                searchEnabled: true,
                searchPlaceholderValue: 'Type to search or add custom skill',
                placeholder: true,
                placeholderValue: 'Select or type to add skills',
                delimiter: ',',
                editItems: true,
                addItems: true,
                duplicateItemsAllowed: false,
                shouldSort: false
            });
        } else {
            console.warn('Soft skills select element not found');
        }

        // Handle platform/social media links
        const platformsContainer = document.getElementById('platformsContainer');
        const addPlatformBtn = document.getElementById('addPlatform');

        if (addPlatformBtn) {
            console.log('Setting up platform/social media links');
        addPlatformBtn.addEventListener('click', function() {
                console.log('Add Platform button clicked');
                addPlatformField();
        });
        } else {
            console.warn('Add platform button not found');
        }
        
        if (platformsContainer) {
        platformsContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-field') || e.target.closest('.remove-field')) {
                const field = e.target.closest('.mb-3');
                field.remove();
            }
        });
        } else {
            console.warn('Platforms container not found');
        }

        // Update profile picture preview
        function updateProfilePicturePreview() {
            const profilePicture = document.getElementById('profilePicture');
            const profilePicturePreview = document.getElementById('profilePicturePreview');
            const profilePictureLabel = document.getElementById('profilePictureLabel');
            
            if (profilePicture.files && profilePicture.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    profilePicturePreview.src = e.target.result;
                    profilePictureLabel.textContent = 'Change Profile Picture';
                };
                reader.readAsDataURL(profilePicture.files[0]);
            } else {
                // If no file is selected, use the current profile picture or default
                const currentPicture = profilePicturePreview.getAttribute('data-current');
                if (currentPicture && !currentPicture.includes('blank-avatar.png')) {
                    // Ensure the path starts with /uploads/
                    profilePicturePreview.src = currentPicture.startsWith('/uploads/') ? 
                        currentPicture : 
                        `/uploads/${currentPicture}`;
                } else {
                    profilePicturePreview.src = '/assets/images/user/blank-avatar.png';
                }
                profilePictureLabel.textContent = 'Upload Profile Picture';
            }
        }

        // Function to handle resume upload
        function handleResumeUpload(event) {
          const file = event.target.files[0];
          if (file) {
            console.log('Resume file selected:', file.name);
            // You can add file size validation here if needed
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
              showToast('Resume file size should be less than 5MB', 'error');
              event.target.value = ''; // Clear the file input
              return;
            }
          }
        }

        // Add mapping functions for year of study conversion
        const yearOfStudyMapping = {
            'Freshman': '1st Year',
            'Sophomore': '2nd Year',
            'Junior': '3rd Year',
            'Senior': '4th Year',
            'Graduate': 'Graduate',
            'Post Graduate': 'Other'
        };
        const reverseYearOfStudyMapping = {
            '1st Year': 'Freshman',
            '2nd Year': 'Sophomore',
            '3rd Year': 'Junior',
            '4th Year': 'Senior',
            'Graduate': 'Graduate',
            'Other': 'Post Graduate'
        };

        // Handle form submission
        document.getElementById('editProfileForm').addEventListener('submit', async function(e) {
          e.preventDefault();
          console.log('Form submission started');
          
          // Process cropped image if available
          if (window.currentCropper) {
            try {
              console.log('Found active cropper instance, processing cropped image before submission');
              const canvas = window.currentCropper.getCroppedCanvas({
                width: 400,
                height: 400
              });
              
              if (canvas) {
                const blob = await new Promise(resolve => {
                  canvas.toBlob(blob => resolve(blob), 'image/jpeg', 0.95);
                });
                
                if (blob) {
                  // Store the blob for form submission
                  window.croppedProfileImage = blob;
                  console.log('Successfully processed cropped image from active cropper instance');
                }
              }
            } catch (err) {
              console.error('Error processing active cropper instance:', err);
            }
          }

          try {
            const formData = new FormData(this);
            const data = {};

            // Helper function to properly format gender and pronouns data
            function formatFieldWithCustom(value, customValue = null) {
              if (!value) return undefined;
              return {
                value: value,
                custom: value === 'Other' ? customValue : null
              };
            }

            // Build the data object with proper structure
            for (let [key, value] of formData.entries()) {
              console.log(`Processing form field: ${key} = ${value}`);
              
              // Skip empty file inputs and handle them separately
              if ((key === 'profilePicture' || key === 'resume') && (!value || value.size === 0)) {
                continue;
              }

              switch(key) {
                case 'my_interests':
                  try {
                    const industries = JSON.parse(value);
                    if (Array.isArray(industries)) {
                      data.my_interests = industries;
                    }
                  } catch (e) {
                    console.error('Error parsing industries:', e);
                    data.my_interests = [];
                  }
                  break;

                case 'interests_looking_in_others':
                  try {
                    // First check if we have valid JSON
                    const interests = JSON.parse(value);
                    if (Array.isArray(interests)) {
                      console.log('Parsing interests_looking_in_others from JSON:', interests);
                      data.interests_looking_in_others = interests;
                    } else {
                      console.warn('interests_looking_in_others parsed but not an array:', interests);
                      // Try to handle non-array values (convert to array)
                      data.interests_looking_in_others = [interests].filter(Boolean);
                    }
                  } catch (e) {
                    console.error('Error parsing looking for interests:', e);
                    console.log('Raw interests_looking_in_others value:', value);
                    
                    // Try to handle non-JSON values
                    if (typeof value === 'string' && value.trim()) {
                      // If it's a comma-separated list
                      if (value.includes(',')) {
                        data.interests_looking_in_others = value.split(',').map(i => i.trim()).filter(Boolean);
                      } else {
                        // Single value
                        data.interests_looking_in_others = [value.trim()];
                      }
                      console.log('Converted interests_looking_in_others to array:', data.interests_looking_in_others);
                    } else {
                    data.interests_looking_in_others = [];
                    }
                  }
                  break;

                case 'dateOfBirth':
                  if (value) {
                    try {
                      // Convert to Date object then to ISO string to ensure proper formatting
                      const dateObj = new Date(value);
                      if (!isNaN(dateObj.getTime())) {
                        data.date_of_birth = dateObj.toISOString().split('T')[0];
                      }
                    } catch (e) {
                      console.error('Error parsing date of birth:', e);
                    }
                  }
                  break;

                case 'phone':
                  if (value && value.trim()) {
                    data.phone_number = value.trim();
                  }
                  break;

                case 'platforms[]':
                  // Handle platforms - collect all the platform values into an array
                  if (!data.platforms) {
                    data.platforms = [];
                  }
                  if (value) {
                    data.platforms.push(value);
                    console.log(`Added platform: ${value} to platforms array. Current platforms:`, data.platforms);
                  }
                  break;

                case 'urls[]':
                  // Handle urls - collect all the url values into an array
                  if (!data.urls) {
                    data.urls = [];
                  }
                  
                  // Always push the URL even if empty to maintain index alignment with platforms
                  data.urls.push(value || '');
                  console.log(`Added URL: ${value || '(empty)'} to URLs array. Current URLs:`, data.urls);
                  break;

                case 'major_category':
                  if (value) {
                    data.major_category = {
                      value: value,
                      custom: value === 'Other' ? formData.get('major_custom') : null
                    };
                  }
                  break;

                case 'major_sub_category':
                  const majorSubCategoryInput = document.getElementById('major-sub-category-input');
                  const selectedMajor = document.getElementById('major-select')?.value;
                  
                  if (majorSubCategoryInput && majorSubCategoryInput.value && majorSubCategoryInput.value !== 'N/A') {
                    const customValue = majorSubCategoryInput.getAttribute('data-custom');
                    const value = majorSubCategoryInput.value;
                    
                    // Validate that the value matches the selected major
                    if (selectedMajor && value.includes('CUSTOM_')) {
                      const expectedPrefix = `CUSTOM_${selectedMajor.toUpperCase()}`;
                      if (value !== expectedPrefix) {
                        majorSubCategoryInput.value = expectedPrefix;
                      }
                    }
                    
                    console.log('Major sub category:', {
                      value: majorSubCategoryInput.value,
                      custom: customValue,
                      selectedMajor
                    });
                    
                    data.major_sub_category = {
                      value: majorSubCategoryInput.value,
                      custom: customValue
                    };
                  } else {
                    // If empty or N/A, don't include in the data
                    console.log('Major sub category is empty or N/A, skipping');
                  }
                  break;

                case 'institution':
                  const ipedsid = institutionInput.getAttribute('data-ipedsid');
                  if (value) {
                    data.institution = {
                      value: value.trim(),
                      custom: (!ipedsid || ipedsid === 'manual-entry') ? value.trim() : null,
                      ipedsid: ipedsid || 'manual-entry'
                    };
                    console.log('Setting institution data:', data.institution);
                  }
                  break;

                case 'yearOfStudy':
                  if (value) {
                    data.year_of_study = {
                      value: value,
                      custom: null
                    };
                  }
                  break;

                case 'gender':
                  if (value) {
                    data.gender = formatFieldWithCustom(value, formData.get('gender_custom'));
                  }
                  break;

                case 'pronouns':
                  if (value) {
                    data.pronoun = formatFieldWithCustom(value, formData.get('pronouns_custom'));
                  }
                  break;

                case 'technical_skills':
                  try {
                    const skills = JSON.parse(value);
                    if (Array.isArray(skills)) {
                      data.technical_skills = skills;
                    }
                  } catch (e) {
                    data.technical_skills = [];
                  }
                  break;
                case 'soft_skills':
                  try {
                    const skills = JSON.parse(value);
                    if (Array.isArray(skills)) {
                      data.soft_skills = skills;
                    }
                  } catch (e) {
                    data.soft_skills = [];
                  }
                  break;
                case 'co_founders_looking_for':
                  if (value !== '' && !isNaN(value)) {
                    const numValue = Number(value);
                    if (numValue >= 0) {
                      data.co_founders_looking_for = numValue;
                      data.co_founders_count = numValue;
                    }
                  } else {
                    console.log('Co-founders value is empty or invalid, setting to 0');
                    data.co_founders_looking_for = 0;
                    data.co_founders_count = 0;
                  }
                  break;

                case 'zipCode':
                  if (value) {
                    data.zip = {
                      value: value,
                      custom: null
                    };
                  }
                  break;

                case 'state':
                  if (value) {
                    data.state = {
                      value: value,
                      custom: null
                    };
                  }
                  break;

                case 'city':
                  if (value) {
                    data.city = {
                      value: value,
                      custom: null
                    };
                  }
                  break;

                case 'address':
                  if (value) {
                    data.address = value;
                  }
                  break;

                case 'resume':
                  // Don't include resume in the JSON data
                  continue;

                default:
                  // Handle other fields
                  if (value !== '') {
                    data[key] = value;
                  }
              }
            }

            // Special handling for fullName to map it to full_name in the database
            if (formData.get('fullName') && !data.full_name) {
              data.full_name = formData.get('fullName');
              console.log('Setting full_name from fullName field:', data.full_name);
            }

            console.log('Submitting data:', data);

            const token = localStorage.getItem('token');
            if (!token) {
              throw new Error('No authentication token found. Please log in again.');
            }

            // Create a new FormData for the actual submission
            const submitFormData = new FormData();
            
            // Add all non-file fields as a single JSON string
            submitFormData.append('data', JSON.stringify(data));

            // Add files only if they exist and have content
            const profilePicture = formData.get('profilePicture');
            
            // Use the cropped image if it exists, otherwise use the one from the form
            if (window.croppedProfileImage && (!profilePicture || profilePicture.size === 0)) {
              // Create a file from the blob
              const fileName = 'profile-picture-' + new Date().getTime() + '.jpg';
              const croppedFile = new File([window.croppedProfileImage], fileName, { type: 'image/jpeg' });
              submitFormData.append('profilePicture', croppedFile);
              // Clear the global variable after using it
              window.croppedProfileImage = null;
            } else if (profilePicture && profilePicture.size > 0) {
              submitFormData.append('profilePicture', profilePicture);
            }
            
            const resume = formData.get('resume');

            if (resume && resume.size > 0) {
              submitFormData.append('resume', resume);
            }

            // Log final data for debugging
            console.log('Final data being submitted:', data);
            console.log('Critical fields:', {
              gender: data.gender,
              pronoun: data.pronoun,
              phone: data.phone,
              dateOfBirth: data.dateOfBirth
            });

            const response = await fetch('/api/profile/update', {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${token}`
              },
              body: submitFormData
            });

            if (!response.ok) {
              const errorData = await response.json();
              console.error('Server error details:', errorData);
              throw new Error(errorData.message || 'Error updating profile');
            }

            const result = await response.json();
            if (result.success) {
              showToast('Profile updated successfully!', 'success');
              
              // Refresh the data instead of redirecting
              await fetchProfileData();
              
              // Switch to the profile tab to show the changes
              const profileTab = document.getElementById('profile-tab-1');
              if (profileTab) {
                profileTab.click();
              }
            } else {
              throw new Error(result.message || 'Error updating profile');
            }
          } catch (error) {
            console.error('Error updating profile:', error);
            if (error.message.includes('authentication token')) {
              showToast('Please log in again to continue', 'error');
              setTimeout(() => {
                window.location.href = '/login.html';
              }, 1500);
            } else {
              showToast(error.message || 'Failed to update profile. Please try again.', 'error');
            }
          }
        });

        // Add event listener for resume upload
        const resumeInput = document.getElementById('resumeInput');
        if (resumeInput) {
          resumeInput.addEventListener('change', handleResumeUpload);
        }

        // Fetch profile data
        console.log('Fetching profile data');
        fetchProfileData();

        // Load shared components
        fetch('components/sidebar.html')
          .then(response => response.text())
          .then(data => {
            document.getElementById('sidebar-container').innerHTML = data;
            feather.replace();
          });
        
        fetch('components/header.html')
          .then(response => response.text())
          .then(data => {
            document.getElementById('header-container').innerHTML = data;
            feather.replace();
          });
        
        fetch('components/theme-settings.html')
          .then(response => response.text())
          .then(data => {
            document.getElementById('theme-settings-container').innerHTML = data;
            feather.replace();
          })
          .then(() => {
            updateUserProfile();
          });

        // Function to fetch profile data
        async function fetchProfileData() {
          try {
            const token = localStorage.getItem('token');
            if (!token) {
              console.log('No token found, redirecting to login');
              window.location.href = '/login.html';
              return;
            }

            console.log('Fetching profile data...');
            const response = await fetch('/api/profile/data', {
              headers: {
                'Authorization': `Bearer ${token}`
              }
            });

            if (!response.ok) {
              throw new Error('Failed to fetch profile data');
            }

            const data = await response.json();
            console.log('Raw profile data received:', data);
            
            // Store profile data globally for access across functions
            window.profileData = data;
            
            // Log specific social media related fields for debugging
            console.log('Social media data in profile:', {
              platforms: data.platforms,
              urls: data.urls,
              socialLinks: data.socialLinks,
              platformsType: data.platforms ? typeof data.platforms : 'undefined',
              urlsType: data.urls ? typeof data.urls : 'undefined',
              platformsIsArray: Array.isArray(data.platforms),
              urlsIsArray: Array.isArray(data.urls),
              platformsLength: Array.isArray(data.platforms) ? data.platforms.length : 0,
              urlsLength: Array.isArray(data.urls) ? data.urls.length : 0
            });
            
            // Normalize data structures for consistent handling
            
            // Handle social media fields
            if (!data.urls && Array.isArray(data.socialLinks)) {
              console.log('Normalizing data: urls is undefined but socialLinks exists, using socialLinks as urls');
              data.urls = [...data.socialLinks]; // Create a copy to avoid reference issues
            }
            
            // Handle interests fields
            if (!data.interests_looking_in_others && Array.isArray(data.lookingForInterests)) {
              console.log('Normalizing data: interests_looking_in_others is undefined but lookingForInterests exists, copying data');
              data.interests_looking_in_others = [...data.lookingForInterests];
            } else if (!Array.isArray(data.interests_looking_in_others)) {
              console.log('Normalizing data: interests_looking_in_others is not an array, initializing as empty array');
              data.interests_looking_in_others = [];
            }
            
            // Ensure my_interests is also an array
            if (!Array.isArray(data.my_interests) && Array.isArray(data.myInterests)) {
              console.log('Normalizing data: my_interests is not an array but myInterests exists, copying data');
              data.my_interests = [...data.myInterests];
            } else if (!Array.isArray(data.my_interests)) {
              console.log('Normalizing data: my_interests is not an array, initializing as empty array');
              data.my_interests = [];
            }
            
            // Log interest fields after normalization
            console.log('Interest fields after normalization:', {
              my_interests: data.my_interests,
              myInterests: data.myInterests,
              interests_looking_in_others: data.interests_looking_in_others,
              lookingForInterests: data.lookingForInterests
            });
            
            if (!data) {
              console.error('No data received from server');
              return;
            }

            // Log all possible name and phone fields
            console.log('Profile data fields:', {
              username: data.username,
              full_name: data.full_name,
              fullName: data.fullName,
              name: data.name,
              fullname: data.fullname,
              email: data.email,
              phone_number: data.phone_number,
              phone: data.phone,
              phoneNumber: data.phoneNumber,
              phone_number: data.phone_number
            });
            
            // Ensure the data has the correct structure
            if (!data.username) {
              console.warn('username is missing in the data');
            }
            if (!data.full_name && !data.fullName && !data.name && !data.fullname) {
              console.warn('full name is missing in the data');
            }
            if (!data.email) {
              console.warn('email is missing in the data');
            }
            if (!data.phone_number && !data.phone && !data.phoneNumber) {
              console.warn('phone number is missing in the data');
            }
            
            // Call both update functions
            updateProfileData(data);
            populateEditForm(data);
          } catch (error) {
            console.error('Error fetching profile data:', error);
          }
        }

        // Function to update profile data
        function updateProfileData(data) {
          console.log('Updating profile data with:', data);
          
          // Update private mode setting if available
          const privateModeSwitch = document.getElementById('privateMode');
          if (privateModeSwitch && data.privateMode !== undefined) {
            privateModeSwitch.checked = data.privateMode;
            console.log('Setting private mode switch to:', data.privateMode);
          }
          
          // Profile Picture
          const profilePic = document.getElementById('profile-picture');
          if (data.profile_picture) {
            profilePic.src = `/uploads/${data.profile_picture}`;
          } else {
            profilePic.src = '../assets/images/user/blank-avatar.png';
          }
          
          // Update resume status
          const resumeStatus = document.getElementById('resumeStatus');
          if (data.resume) {
            resumeStatus.textContent = 'Resume uploaded';
            resumeStatus.className = 'ms-2 text-success';
          } else {
            resumeStatus.textContent = 'No resume uploaded';
            resumeStatus.className = 'ms-2 text-danger';
          }
          
          // Update resume modal
          if (data.resume) {
            console.log('Updating resume modal with resume path:', data.resume);
            updateResumeModal(data.resume);
          } else {
            console.log('No resume found in profile data');
          }
          
          // Basic Info - Personal Details
          document.getElementById('username').textContent = data.username || 'N/A';
          
          // Check all possible name fields
          const fullName = data.full_name || data.fullName || data.name || data.fullname || 'N/A';
          document.getElementById('full-name').textContent = fullName;
          document.getElementById('personal-full-name').textContent = fullName;
          
          // Year of study - check all possible formats
          const yearOfStudyValue = data.year_of_study?.value || 
                              data.yearOfStudy || 
                              (data.year_of_study?.custom || 'N/A');
          console.log('Setting year of study to:', yearOfStudyValue);
          
          document.getElementById('year-of-study').textContent = yearOfStudyValue;
          document.getElementById('education-year').textContent = yearOfStudyValue;
          
          // Date of birth
          const dobEl = document.getElementById('date-of-birth');
          if (dobEl) {
            let dob = 'N/A';
            if (data.date_of_birth) {
              try {
                const date = new Date(data.date_of_birth);
                dob = date.toLocaleDateString();
              } catch (e) {
                console.error('Error formatting date of birth:', e);
              }
            } else if (data.dateOfBirth) {
              try {
                const date = new Date(data.dateOfBirth);
                dob = date.toLocaleDateString();
              } catch (e) {
                console.error('Error formatting date of birth:', e);
              }
            }
            dobEl.textContent = dob;
          }
          
          // Gender
          const genderEl = document.getElementById('gender');
          if (genderEl) {
            const gender = data.gender?.value || data.gender || 'N/A';
            genderEl.textContent = gender;
          }
          
          // Pronouns
          const pronounsEl = document.getElementById('pronouns');
          if (pronounsEl) {
            const pronouns = data.pronoun?.value || data.pronouns || 'N/A';
            pronounsEl.textContent = pronouns;
          }
          
          // About me / Bio
          const aboutMeEl = document.getElementById('about-me');
          if (aboutMeEl) {
            const bio = data.bio || data.aboutMe || 'No bio available';
            aboutMeEl.textContent = bio;
          }
          
          // Institution and Education details
          const institutionValue = data.institution?.value || data.institution || data.institute || 'N/A';
          document.getElementById('institution').textContent = institutionValue;
          document.getElementById('institute').textContent = institutionValue;
          
          // Major
          const majorEl = document.getElementById('major');
          if (majorEl) {
            const major = data.major_category?.value || data.major || 'N/A';
            majorEl.textContent = major;
          }
          
          // Major Type
          const majorTypeEl = document.getElementById('major-type');
          if (majorTypeEl) {
            const majorType = data.major_type || data.majorType || 'N/A';
            majorTypeEl.textContent = majorType;
          }
          
          // Major Sub Category
          const majorSubCatEl = document.getElementById('major-sub-category');
          if (majorSubCatEl) {
            const majorSubCat = data.major_sub_category?.value || data.majorSubCategory || 'N/A';
            const custom = data.major_sub_category?.custom || (data.majorSubCategory && data.majorSubCategory.custom);
            majorSubCatEl.textContent = custom || majorSubCat;
          }
          
          // Contact Info
          // Phone
          const phoneNumber = data.phone_number || data.phone || data.phoneNumber || 'N/A';
          document.getElementById('phone').textContent = phoneNumber;
          
          // Email
          document.getElementById('email').textContent = data.email || 'N/A';
          
          // Co-founders
          const coFoundersEl = document.getElementById('co-founders-count');
          if (coFoundersEl) {
            const coFoundersCount = data.co_founders_count || data.co_founders_looking_for || data.coFoundersCount || '0';
            coFoundersEl.textContent = coFoundersCount;
          }
          
          // Address components
          const city = data.city?.value || data.city || '';
          const state = data.state?.value || data.state || '';
          const zip = data.zip?.value || data.zipCode || data.zip || '';
          const address = data.address || '';
          
          // Format components for display
          let locationText = '';
          if (city && state) {
            locationText = `${city}, ${state}`;
            if (zip) locationText += ` ${zip}`;
          } else if (address) {
            locationText = address;
          } else {
            locationText = 'N/A';
          }
          
          // Location/Address
          document.getElementById('location').textContent = locationText;
          
          // State
          const stateEl = document.getElementById('state');
          if (stateEl) {
            stateEl.textContent = state || 'N/A';
          }
          
          // City
          const cityEl = document.getElementById('city');
          if (cityEl) {
            cityEl.textContent = city || 'N/A';
          }
          
          // Zip Code
          const zipCodeEl = document.getElementById('zip-code');
          if (zipCodeEl) {
            zipCodeEl.textContent = zip || 'N/A';
          }
          
          // Full address
          const addressEl = document.getElementById('address');
          if (addressEl) {
            addressEl.textContent = address || 'N/A';
          }
          
          // Skills
          // Hard skills
          const hardSkillsEl = document.getElementById('hard-skills');
          if (hardSkillsEl) {
            const hardSkills = data.technical_skills || data.hardSkills || [];
            if (Array.isArray(hardSkills) && hardSkills.length > 0) {
              hardSkillsEl.textContent = hardSkills.join(', ');
            } else {
              hardSkillsEl.textContent = 'None specified';
            }
          }
          
          // Soft skills
          const softSkillsEl = document.getElementById('soft-skills');
          if (softSkillsEl) {
            const softSkills = data.soft_skills || data.softSkills || [];
            if (Array.isArray(softSkills) && softSkills.length > 0) {
              softSkillsEl.textContent = softSkills.join(', ');
            } else {
              softSkillsEl.textContent = 'None specified';
            }
          }
          
          // Update my interests
          const myInterests = data.my_interests || data.myInterests || [];
          const myInterestsContainer = document.getElementById('my-interests');
          if (myInterestsContainer) {
            if (Array.isArray(myInterests) && myInterests.length > 0) {
              myInterestsContainer.textContent = myInterests.join(', ');
            } else {
              myInterestsContainer.textContent = 'None specified';
            }
          }
          
          // Update looking for interests
          const lookingForInterests = data.interests_looking_in_others || data.lookingForInterests || [];
          const lookingForContainer = document.getElementById('looking-for-interests');
          if (lookingForContainer) {
            if (Array.isArray(lookingForInterests) && lookingForInterests.length > 0) {
              lookingForContainer.textContent = lookingForInterests.join(', ');
              console.log('Updated looking for interests in profile view with:', lookingForInterests.join(', '));
            } else {
              lookingForContainer.textContent = 'None specified';
              console.log('No looking for interests found, showing "None specified"');
            }
          } else {
            console.error('Looking for interests container not found in profile view');
          }
          
          // Profile completion percentage and connections count section has been removed
          
          // Display social media links
          displaySocialMediaLinks(data);
        }
        
        // Function to display social media links on profile
        function displaySocialMediaLinks(data) {
          console.log('Displaying social media links with data:', {
            platforms: data.platforms,
            urls: data.urls,
            socialLinks: data.socialLinks
          });
          
          // Get the social links container in the profile view
          const socialLinksContainer = document.getElementById('social-links');
          if (!socialLinksContainer) {
            console.error('Social links container not found');
              return;
          }

          // Clear container
          socialLinksContainer.innerHTML = '';
          
          // Map of platform names to icons
          const platformIcons = {
            'linkedin': 'ti ti-brand-linkedin',
            'github': 'ti ti-brand-github',
            'twitter': 'ti ti-brand-twitter',
            'facebook': 'ti ti-brand-facebook',
            'instagram': 'ti ti-brand-instagram',
            'youtube': 'ti ti-brand-youtube',
            'tiktok': 'ti ti-brand-tiktok',
            'website': 'ti ti-world'
          };
          
          let hasLinks = false;
          
          // Function to add a link to the container
          function addSocialLink(platform, url) {
            if (!platform) return;
            
            // If URL is missing or empty, generate a default one based on platform
            if (!url || url.trim() === '') {
              switch(platform.toLowerCase()) {
                case 'linkedin': url = 'https://linkedin.com/'; break;
                case 'github': url = 'https://github.com/'; break;
                case 'twitter': url = 'https://twitter.com/'; break;
                case 'facebook': url = 'https://facebook.com/'; break;
                case 'instagram': url = 'https://instagram.com/'; break;
                case 'youtube': url = 'https://youtube.com/'; break;
                case 'tiktok': url = 'https://tiktok.com/'; break;
                case 'website': url = 'https://'; break;
                default: url = 'https://'; break;
              }
            }
            
            // Ensure URL has http/https protocol
            if (url && !url.startsWith('http')) {
              url = 'https://' + url;
            }
            
            hasLinks = true;
            
            try {
              const linkElement = document.createElement('a');
              linkElement.href = url;
              linkElement.target = '_blank';
              linkElement.className = 'btn btn-outline-primary btn-icon m-1';
              linkElement.setAttribute('data-bs-toggle', 'tooltip');
              linkElement.setAttribute('data-bs-placement', 'top');
              linkElement.setAttribute('title', platform.charAt(0).toUpperCase() + platform.slice(1));
              
              // Use the appropriate icon for the platform or a default icon
              const platformKey = platform.toLowerCase();
              const icon = platformIcons[platformKey] || 'ti ti-link';
              linkElement.innerHTML = `<i class="${icon}"></i>`;
              
              socialLinksContainer.appendChild(linkElement);
              console.log(`Added social link for ${platform} with URL ${url}`);
            } catch (error) {
              console.error(`Error adding social link for ${platform}:`, error);
            }
          }
          
          // Check for all possible data formats
          if (Array.isArray(data.platforms) && data.platforms.length > 0) {
            console.log('Found platforms data:', data.platforms);
            
            // If we have both platforms and URLs arrays
            if (Array.isArray(data.urls) && data.urls.length > 0) {
              console.log('Found urls data:', data.urls);
              
              // Add platforms and URLs as pairs
              const count = Math.min(data.platforms.length, data.urls.length);
              for (let i = 0; i < count; i++) {
                addSocialLink(data.platforms[i], data.urls[i]);
              }
              
              // If we have more platforms than URLs, add the remaining platforms with default URLs
              if (data.platforms.length > data.urls.length) {
                for (let i = data.urls.length; i < data.platforms.length; i++) {
                  addSocialLink(data.platforms[i], null);
                }
              }
            } 
            // Try socialLinks as an alternative to URLs
            else if (Array.isArray(data.socialLinks) && data.socialLinks.length > 0) {
              console.log('Using socialLinks instead of urls:', data.socialLinks);
              
              // Add platforms and socialLinks as pairs
              const count = Math.min(data.platforms.length, data.socialLinks.length);
              for (let i = 0; i < count; i++) {
                addSocialLink(data.platforms[i], data.socialLinks[i]);
              }
              
              // If we have more platforms than socialLinks, add the remaining platforms with default URLs
              if (data.platforms.length > data.socialLinks.length) {
                for (let i = data.socialLinks.length; i < data.platforms.length; i++) {
                  addSocialLink(data.platforms[i], null);
                }
              }
            } 
            // No URLs at all, just use platforms with default URLs
            else {
              console.log('No urls or socialLinks found, using platforms with default URLs');
              data.platforms.forEach(platform => {
                addSocialLink(platform, null);
              });
            }
          } else {
            console.log('No platforms array found in data');
          }
          
          // If no links were added, display a message
          if (!hasLinks) {
            socialLinksContainer.innerHTML = '<p class="text-muted mb-0">No social media links added</p>';
          }
          
          // Initialize tooltips for the links
          try {
            const tooltips = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltips.map(function (tooltipTriggerEl) {
              return new bootstrap.Tooltip(tooltipTriggerEl);
            });
          } catch (error) {
            console.error('Error initializing tooltips:', error);
          }
        }

        // Function to populate edit form with existing data
        function populateEditForm(data) {
          console.log('Populating edit form with data:', data);
          
          // Update private mode setting (for when user switches to Settings tab)
          const privateModeSwitch = document.getElementById('privateMode');
          if (privateModeSwitch) {
            // Default is false/off if not specified
            privateModeSwitch.checked = data.privateMode || false;
          }

          // Find all form elements
          const usernameInput = document.querySelector('input[name="username"]');
          const fullNameInput = document.querySelector('input[name="fullName"]');
          const emailInput = document.querySelector('input[name="email"]');
          const phoneInput = document.querySelector('input[name="phone"]');
          const dateOfBirthInput = document.querySelector('input[name="dateOfBirth"]');
          const genderSelect = document.querySelector('select[name="gender"]');
          const pronounsSelect = document.querySelector('select[name="pronouns"]');
          const bioTextarea = document.querySelector('textarea[name="bio"]');
          const yearOfStudySelect = document.querySelector('select[name="yearOfStudy"]');
          const majorSelect = document.getElementById('major-select');
          const majorTypeSelect = document.getElementById('major-type-select');
          const zipCodeInput = document.getElementById('zipCode');
          const stateInput = document.getElementById('state');
          const cityInput = document.getElementById('city');
          const addressTextarea = document.getElementById('address');

          // Log found form elements
          console.log('Found form elements:', {
              usernameInput: !!usernameInput,
              fullNameInput: !!fullNameInput,
              emailInput: !!emailInput,
              phoneInput: !!phoneInput,
              dateOfBirthInput: !!dateOfBirthInput,
              genderSelect: !!genderSelect,
              pronounsSelect: !!pronounsSelect,
              bioTextarea: !!bioTextarea,
              yearOfStudySelect: !!yearOfStudySelect,
              majorSelect: !!majorSelect,
              majorTypeSelect: !!majorTypeSelect,
              zipCodeInput: !!zipCodeInput,
              stateInput: !!stateInput,
              cityInput: !!cityInput,
              addressTextarea: !!addressTextarea
          });

          if (usernameInput) {
              console.log('Setting username:', data.username);
              usernameInput.value = data.username || '';
          }
          if (fullNameInput) {
              const fullName = data.full_name || data.fullName || data.name || data.fullname;
              console.log('Setting full name:', fullName);
              fullNameInput.value = fullName || '';
          }
          if (emailInput) {
              console.log('Setting email:', data.email);
              emailInput.value = data.email || '';
          }
          if (phoneInput) {
              const phoneNumber = data.phone_number || data.phone || data.phoneNumber;
              console.log('Setting phone number:', phoneNumber);
              // Only set if value exists and isn't "N/A"
              if (phoneNumber && phoneNumber !== 'N/A') {
                  phoneInput.value = phoneNumber;
              }
          }
          if (dateOfBirthInput) {
              const dateOfBirth = data.date_of_birth || data.dateOfBirth;
              console.log('Raw date of birth data:', dateOfBirth);
              
              if (dateOfBirth && dateOfBirth !== 'N/A' && dateOfBirth !== null) {
                  try {
                      // Parse the date string in UTC
                      const [year, month, day] = dateOfBirth.split('-');
                      const date = new Date(Date.UTC(year, month - 1, day));
                      
                      if (!isNaN(date.getTime())) {
                          // Format the date as YYYY-MM-DD in UTC
                          const formattedDate = date.toISOString().split('T')[0];
                          console.log('Formatted date for input:', formattedDate);
                          dateOfBirthInput.value = formattedDate;
                      } else {
                          console.warn('Invalid date format:', dateOfBirth);
                      }
                  } catch (error) {
                      console.error('Error formatting date:', error);
                      console.error('Date value that caused error:', dateOfBirth);
                  }
              } else {
                  console.log('No valid date of birth found in data');
                  // Don't set empty value - leave it as is
              }
          }
          if (genderSelect) {
              const gender = data.gender?.value || data.gender;
              console.log('Setting gender:', gender);
              if (gender && gender !== 'N/A' && typeof gender === 'string') {
                  const options = genderSelect.options;
                  for (let i = 0; i < options.length; i++) {
                      if (options[i].value.toLowerCase() === gender.toLowerCase()) {
                          genderSelect.selectedIndex = i;
                          break;
                      }
                  }
              }
          }
          if (pronounsSelect) {
              const pronouns = data.pronoun?.value || data.pronouns;
              console.log('Setting pronouns:', pronouns);
              if (pronouns && pronouns !== 'N/A' && typeof pronouns === 'string') {
                  const options = pronounsSelect.options;
                  for (let i = 0; i < options.length; i++) {
                      if (options[i].value.toLowerCase() === pronouns.toLowerCase()) {
                          pronounsSelect.selectedIndex = i;
                          break;
                      }
                  }
              }
          }
          if (bioTextarea) {
              const bio = data.bio || data.aboutMe;
              console.log('Setting bio:', bio);
              bioTextarea.value = bio || '';
          }
          if (yearOfStudySelect) {
              const yearOfStudy = data.year_of_study?.value || data.yearOfStudy;
              console.log('Setting year of study:', yearOfStudy);
              if (yearOfStudy && yearOfStudy !== 'N/A' && typeof yearOfStudy === 'string') {
                  const clientValue = reverseYearOfStudyMapping[yearOfStudy] || yearOfStudy;
                  const options = yearOfStudySelect.options;
                  for (let i = 0; i < options.length; i++) {
                      if (options[i].value.toLowerCase() === clientValue.toLowerCase()) {
                          yearOfStudySelect.selectedIndex = i;
                          break;
                      }
                  }
              }
          }
          if (majorSelect) {
              const majorCategory = data.major_category?.value || data.major;
              console.log('Setting major:', majorCategory);
              if (majorCategory && majorCategory !== 'N/A' && typeof majorCategory === 'string') {
                  const options = majorSelect.options;
                  for (let i = 0; i < options.length; i++) {
                      if (options[i].value.toLowerCase() === majorCategory.toLowerCase()) {
                          majorSelect.selectedIndex = i;
                          break;
                      }
                  }
              }
          }
          if (majorTypeSelect) {
              const majorType = data.major_type || data.majorType;
              console.log('Setting major type:', majorType);
              if (majorType && majorType !== 'N/A' && typeof majorType === 'string') {
                  const options = majorTypeSelect.options;
                  for (let i = 0; i < options.length; i++) {
                      if (options[i].value.toLowerCase() === majorType.toLowerCase()) {
                          majorTypeSelect.selectedIndex = i;
                          break;
                      }
                  }
              }
          }

          // Set major sub-category if it exists
          let majorSubCategory = null;
          let majorSubCategoryCustom = null;
          if (data.major_sub_category && typeof data.major_sub_category === 'object') {
              majorSubCategory = data.major_sub_category.value;
              majorSubCategoryCustom = data.major_sub_category.custom;
          } else if (typeof data.major_sub_category === 'string') {
              majorSubCategory = data.major_sub_category;
          } else if (typeof data.majorSubCategory === 'string') {
              majorSubCategory = data.majorSubCategory;
          } else if (data.majorSubCategory && typeof data.majorSubCategory === 'object') {
              majorSubCategory = data.majorSubCategory.value;
              majorSubCategoryCustom = data.majorSubCategory.custom;
          }
          console.log('Populating major subcategory with:', {majorSubCategory, majorSubCategoryCustom, majorSubCategoryDropdown});
          if (majorSubCategory && typeof majorSubCategoryDropdown?.setValue === 'function') {
              majorSubCategoryDropdown.setValue(majorSubCategory, majorSubCategoryCustom);
              // Also set the hidden input
              const hiddenInput = document.getElementById('major-sub-category-input');
              if (hiddenInput) {
                  hiddenInput.value = majorSubCategory;
                  if (majorSubCategoryCustom) {
                      hiddenInput.setAttribute('data-custom', majorSubCategoryCustom);
                  } else {
                      hiddenInput.removeAttribute('data-custom');
                  }
              }
          }

          // Handle institution field
          const institutionInput = document.getElementById('institution');
          if (institutionInput) {
              const institution = data.institution?.value || data.institute;
              const ipedsid = data.institution?.ipedsid;
              console.log('Setting institution:', institution, 'with IPEDS ID:', ipedsid);
              if (institution && institution !== 'N/A') {
                  institutionInput.value = institution;
                  // Set IPEDS ID if available, otherwise use 'manual-entry'
                  if (ipedsid && ipedsid !== 'null' && ipedsid !== 'undefined') {
                      institutionInput.setAttribute('data-ipedsid', ipedsid);
                      console.log('Setting IPEDS ID attribute to:', ipedsid);
                  } else {
                      // Set a placeholder IPEDS ID for manual entries
                      institutionInput.setAttribute('data-ipedsid', 'manual-entry');
                      console.log('Setting fallback IPEDS ID (manual-entry)');
                  }
              }
          }

          // Log all form field values after setting them
          console.log('Form field values after population:');
          console.log('Username:', usernameInput?.value);
          console.log('Full Name:', fullNameInput?.value);
          console.log('Email:', emailInput?.value);
          console.log('Phone:', phoneInput?.value);
          console.log('Date of Birth:', dateOfBirthInput?.value);
          console.log('Gender:', genderSelect?.value);
          console.log('Pronouns:', pronounsSelect?.value);
          console.log('Bio:', bioTextarea?.value);
          console.log('Year of Study:', yearOfStudySelect?.value);

          // Initialize industry tags
          if (data.my_interests && Array.isArray(data.my_interests)) {
            console.log('Setting industries in form:', data.my_interests);
            setIndustries(data.my_interests);
          }

          // Initialize looking for interests if they exist - check both fields
          console.log('Looking for interests data:', {
            interests_looking_in_others: data.interests_looking_in_others,
            lookingForInterests: data.lookingForInterests,
            hasInterestsLooking: !!data.interests_looking_in_others && Array.isArray(data.interests_looking_in_others),
            hasLookingFor: !!data.lookingForInterests && Array.isArray(data.lookingForInterests)
          });
          
          if (data.interests_looking_in_others && Array.isArray(data.interests_looking_in_others)) {
            console.log('Setting looking for interests in form from interests_looking_in_others:', data.interests_looking_in_others);
            setLookingForInterests(data.interests_looking_in_others);
          } else if (data.lookingForInterests && Array.isArray(data.lookingForInterests)) {
            console.log('Setting looking for interests in form from lookingForInterests:', data.lookingForInterests);
            setLookingForInterests(data.lookingForInterests);
          } else {
            console.warn('No valid looking for interests data found in any format');
          }

          // Address fields - don't update if we have AddressHandler managing these fields
          if (!window.addressHandler) {
            // Only set address fields if there's no address handler
            if (zipCodeInput && data.zip?.value) {
              console.log('Setting ZIP code value:', data.zip.value);
              zipCodeInput.value = data.zip.value;
            } else {
              console.log('Not setting ZIP code:', {
                zipCodeInput: !!zipCodeInput,
                zipData: data.zip
              });
            }
            
            if (stateInput && data.state?.value) {
              console.log('Setting state value:', data.state.value);
              stateInput.value = data.state.value;
            }
            
            if (cityInput && data.city?.value) {
              console.log('Setting city value:', data.city.value);
              cityInput.value = data.city.value;
            }
            
            if (addressTextarea && data.address) {
              console.log('Setting address value:', data.address);
              addressTextarea.value = data.address;
            }
          } else {
            console.log('AddressHandler is managing address fields, skipping manual updates');
          }

          // Populate social media fields
          populateSocialMediaFields(data);
        }

        // Function to populate social media fields
        function populateSocialMediaFields(data) {
            console.log('Populating social media fields with data:', {
                platforms: data.platforms,
                urls: data.urls,
                socialLinks: data.socialLinks
            });
            
            // Normalize data structure first
            if (!data.urls && Array.isArray(data.socialLinks)) {
                console.log('urls is undefined but socialLinks exists, using socialLinks as urls');
                data.urls = [...data.socialLinks]; // Create a copy to avoid reference issues
            }
            
            // Get the container
            const container = document.getElementById('platformsContainer');
            if (!container) {
                console.error('Social media container not found');
                return;
            }
            
            // Clear existing fields
            container.innerHTML = '';
            
            // Check if we have platforms data
            if (Array.isArray(data.platforms) && data.platforms.length > 0) {
                console.log('Found platforms data:', data.platforms);
                
                // If we have both platforms and urls
                if (Array.isArray(data.urls) && data.urls.length > 0) {
                    console.log('Found urls data:', data.urls);
                    
                    // Add fields for each platform and url pair
                    const count = Math.min(data.platforms.length, data.urls.length);
                    for (let i = 0; i < count; i++) {
                        if (data.platforms[i]) {
                            addPlatformField(data.platforms[i], data.urls[i] || '');
                        }
                    }
                    
                    // If we have more platforms than urls
                    if (data.platforms.length > data.urls.length) {
                        for (let i = data.urls.length; i < data.platforms.length; i++) {
                            if (data.platforms[i]) {
                                addPlatformField(data.platforms[i], '');
                            }
                        }
                    }
                } 
                // Try to use socialLinks if urls is not available
                else if (Array.isArray(data.socialLinks) && data.socialLinks.length > 0) {
                    console.log('No urls array but found socialLinks data:', data.socialLinks);
                    const count = Math.min(data.platforms.length, data.socialLinks.length);
                    for (let i = 0; i < count; i++) {
                        if (data.platforms[i]) {
                            addPlatformField(data.platforms[i], data.socialLinks[i] || '');
                        }
                    }
                    
                    // If we have more platforms than socialLinks
                    if (data.platforms.length > data.socialLinks.length) {
                        for (let i = data.socialLinks.length; i < data.platforms.length; i++) {
                            if (data.platforms[i]) {
                                addPlatformField(data.platforms[i], '');
                            }
                        }
                    }
                } else {
                    // We have platforms but no urls or socialLinks
                    console.log('No urls or socialLinks data found, creating fields with empty urls');
                    data.platforms.forEach(platform => {
                        if (platform) {
                            addPlatformField(platform, '');
                        }
                    });
                }
            } else {
                // Check for alternative data format
                // Sometimes data might be structured differently, let's check all possible formats
                const possiblePlatforms = data.socialPlatforms || data.social_platforms || [];
                
                if (Array.isArray(possiblePlatforms) && possiblePlatforms.length > 0) {
                    console.log('Found alternative platforms data:', possiblePlatforms);
                    // Use alternative data format
                    possiblePlatforms.forEach((platform, index) => {
                        const url = (data.socialLinks && data.socialLinks[index]) || 
                                   (data.social_links && data.social_links[index]) || '';
                        addPlatformField(platform, url);
                    });
                } else {
                    // No existing social media data, add one empty field
                    console.log('No social media data found in any format, adding empty field');
                    addPlatformField();
                }
            }
        }

        // Function to add a platform field
        function addPlatformField(platform = '', url = '') {
            console.log(`Adding platform field with platform: ${platform}, url: ${url}`);
            
            const container = document.getElementById('platformsContainer');
            if (!container) {
                console.error('Social media container not found');
                return;
            }
            
            const platformField = document.createElement('div');
            platformField.className = 'mb-3';
            
            // Create the options for the select
            const platformOptions = [
                { value: 'linkedin', label: 'LinkedIn' },
                { value: 'github', label: 'GitHub' },
                { value: 'twitter', label: 'Twitter' },
                { value: 'facebook', label: 'Facebook' },
                { value: 'instagram', label: 'Instagram' },
                { value: 'youtube', label: 'YouTube' },
                { value: 'tiktok', label: 'TikTok' },
                { value: 'website', label: 'Website' }
            ];
            
            const options = platformOptions.map(p => 
                `<option value="${p.value}" ${p.value === platform ? 'selected' : ''}>${p.label}</option>`
            ).join('');
            
            // Ensure url is a string and properly escape it for HTML attribute
            const safeUrl = (url || '').toString();
            const escapedUrl = safeUrl.replace(/"/g, '&quot;');
            
            // Create the field HTML
            platformField.innerHTML = `
                <div class="input-group">
                    <select class="form-select platform-select" name="platforms[]">
                        <option value="">Select Platform</option>
                        ${options}
                    </select>
                    <input type="url" class="form-control" name="urls[]" placeholder="Enter URL" value="${escapedUrl}">
                    <button type="button" class="btn btn-danger remove-field">
                        <i class="ti ti-trash"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(platformField);
            
            // Log what was actually added to the DOM for debugging
            const selectElement = platformField.querySelector('select');
            const inputElement = platformField.querySelector('input[type="url"]');
            
            console.log('Platform field created with:', {
                selectValue: selectElement.value,
                inputValue: inputElement.value
            });
        }

        // Load institutions data
        let institutions = [];
        fetch('/assets/api/us-colleges-and-universities.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Failed to load institutions data: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (Array.isArray(data) && data.length > 0) {
                    console.log(`Successfully loaded ${data.length} institutions`);
                institutions = data;
                } else {
                    console.warn('Institutions data loaded but may be invalid:', data);
                    showToast('Institution search may be limited. Please type your institution manually if not found.', 'warning');
                }
            })
            .catch(error => {
                console.error('Error loading institutions data:', error);
                // Enable manual entry for institutions in case of load failure
                const institutionInput = document.getElementById('institution');
                if (institutionInput) {
                    institutionInput.setAttribute('placeholder', 'Type your institution name manually');
                    institutionInput.setAttribute('data-manual-mode', 'true');
                }
                showToast('Institution search is unavailable. Please type your institution manually.', 'warning');
            });

        // Institution search functionality
        const institutionInput = document.getElementById('institution');
        const suggestionsDiv = document.getElementById('institutionSuggestions');

        institutionInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm.length < 2) {
                suggestionsDiv.style.display = 'none';
                return;
            }

            const filteredInstitutions = institutions.filter(inst => 
                inst.name.toLowerCase().includes(searchTerm) || 
                inst.city.toLowerCase().includes(searchTerm)
            ).slice(0, 10); // Limit to 10 suggestions

            if (filteredInstitutions.length > 0) {
                suggestionsDiv.innerHTML = filteredInstitutions.map(inst => 
                    `<a href="#" class="list-group-item list-group-item-action" 
                        data-name="${inst.name}" 
                        data-city="${inst.city}"
                        data-state="${inst.state}"
                        data-ipedsid="${inst.ipedsid}">
                        ${inst.name} | ${inst.city}, ${inst.state}
                    </a>`
                ).join('');
                suggestionsDiv.style.display = 'block';
            } else {
                suggestionsDiv.style.display = 'none';
            }
        });

        // Handle suggestion selection
        suggestionsDiv.addEventListener('click', function(e) {
            if (e.target.classList.contains('list-group-item')) {
                const name = e.target.dataset.name;
                const city = e.target.dataset.city;
                const state = e.target.dataset.state;
                const ipedsid = e.target.dataset.ipedsid;
                institutionInput.value = `${name} | ${city}, ${state}`;
                institutionInput.setAttribute('data-ipedsid', ipedsid);
                suggestionsDiv.style.display = 'none';
            }
        });

        // Add validation before form submission
        document.getElementById('editProfileForm').addEventListener('submit', function(e) {
            const institutionValue = institutionInput.value;
            if (institutionValue && !institutionInput.getAttribute('data-ipedsid')) {
                // Instead of blocking submission, add a warning and continue
                console.warn('Institution selected without IPEDS ID, proceeding anyway');
                // Set a generic IPEDS ID to allow form submission
                institutionInput.setAttribute('data-ipedsid', 'manual-entry');
                // Continue with form submission
            }
        });

        // Initialize the major sub-category dropdown
        const majorSubCategoryContainer = document.getElementById('major-sub-category-container');
        if (majorSubCategoryContainer) {
            majorSubCategoryDropdown = new MajorSubCategoryDropdown('major-sub-category-container', function(value) {
                console.log('Selected major sub-category:', value);
                // Update hidden input for form submission
                const hiddenInput = document.getElementById('major-sub-category-input');
                if (hiddenInput) {
                    // Store the value directly in the input
                    hiddenInput.value = value.value;
                    // Store custom value as a data attribute if present
                    if (value.custom) {
                        hiddenInput.setAttribute('data-custom', value.custom);
                    } else {
                        hiddenInput.removeAttribute('data-custom');
                    }
                }
            });
        }
        
        // Add event listener for major category change
        document.getElementById('major-select')?.addEventListener('change', function(e) {
            const selectedMajor = e.target.value;
            // Clear the major sub-category if major is changed
            if (majorSubCategoryDropdown) {
                majorSubCategoryDropdown.clear();
            }
        });

        // Initialize industry multi-select
        const industryOptions = [
          "Marketing", "Agriculture Tech", "AI", "AR/VR", "Art", "Cosmetics", "BioTech",
          "Cannabis", "Communications", "Clean Tech", "Fashion", "Cloud", "Web3",
          "CyberSecurity", "Developer tools", "Digital health and wellness",
          "Future of health and work", "Commerce", "Edtech", "Electronics",
          "Entertainment", "Fintech", "Food and Beverage", "E-Sports", "Gov tech",
          "Recruiting", "Hospitality", "DEI", "Insure tech", "IOT", "Legal",
          "Logistics", "Manufacturing", "Marketplace", "Chemicals", "Media",
          "Consumer", "Enterprise", "Other tech", "Parenting",
          "Professional or Technical service", "Prop tech", "Quantum computing",
          "Food services", "Robotics", "Sales tech", "Sex", "Social impact",
          "Space", "Transportation", "Travel"
        ];
        
        const selectedIndustries = new Set();
        const input = document.getElementById('industry-input');
        const dropdown = document.getElementById('industry-dropdown');
        const tagsContainer = document.getElementById('industry-tags-container');
        const hiddenInput = document.getElementById('industry-hidden-input');

        function updateHiddenInput() {
          console.log('Updating hidden input with:', Array.from(selectedIndustries));
          hiddenInput.value = JSON.stringify(Array.from(selectedIndustries));
        }

        function renderDropdown() {
          dropdown.innerHTML = '';
          const inputValue = input.value.toLowerCase();
          const filtered = industryOptions.filter(opt => 
            opt.toLowerCase().includes(inputValue) && !selectedIndustries.has(opt)
          );

          if (filtered.length > 0 && inputValue) {
            dropdown.style.display = 'block';
            filtered.forEach(option => {
              const div = document.createElement('div');
              div.className = 'industry-option';
              div.textContent = option;
              div.onclick = () => {
                addTag(option);
                input.value = '';
                renderDropdown();
                input.focus();
              };
              dropdown.appendChild(div);
            });
          } else {
            dropdown.style.display = 'none';
          }
        }

        function addTag(value) {
          if (!value.trim() || selectedIndustries.has(value)) return;
          
          console.log('Adding industry tag:', value);
          selectedIndustries.add(value);
          updateHiddenInput();
          
          const tag = document.createElement('div');
          tag.className = 'industry-tag';
          tag.textContent = value;

          const removeBtn = document.createElement('span');
          removeBtn.textContent = 'Ã';
          removeBtn.className = 'remove-tag';
          removeBtn.onclick = (e) => {
            e.stopPropagation();
            selectedIndustries.delete(value);
            updateHiddenInput();
            tagsContainer.removeChild(tag);
            renderDropdown();
          };

          tag.appendChild(removeBtn);
          tagsContainer.insertBefore(tag, input);
        }

        // Function to set initial values
        function setIndustries(industries) {
          console.log('Setting industries:', industries);
          selectedIndustries.clear();
          
          // Clear existing tags
          const tags = Array.from(tagsContainer.getElementsByClassName('industry-tag'));
          tags.forEach(tag => tag.remove());
          
          if (Array.isArray(industries)) {
            industries.forEach(industry => {
              if (industry) {
                addTag(industry);
              }
            });
          }
          
          // Update the hidden input
          updateHiddenInput();
        }

        // Add event listeners
        if (input) {
          input.addEventListener('input', () => {
            renderDropdown();
          });

          input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ',') {
              e.preventDefault();
              const customValue = input.value.trim();
              if (customValue) {
                addTag(customValue);
                input.value = '';
                renderDropdown();
              }
            } else if (e.key === 'Backspace' && input.value === '') {
              const tags = tagsContainer.getElementsByClassName('industry-tag');
              if (tags.length > 0) {
                const lastTag = tags[tags.length - 1];
                const value = lastTag.textContent.slice(0, -1); // Remove Ã character
                selectedIndustries.delete(value);
                updateHiddenInput();
                tagsContainer.removeChild(lastTag);
              }
            }
          });
        }

        document.addEventListener('click', (e) => {
          if (!document.getElementById('industry-multi-select').contains(e.target)) {
            dropdown.style.display = 'none';
          }
        });

        // Initialize dropdown
        renderDropdown();

        // Initialize looking for interests multi-select
        const lookingForSelectedIndustries = new Set();
        const lookingForInput = document.getElementById('looking-for-input');
        const lookingForDropdown = document.getElementById('looking-for-dropdown');
        const lookingForTagsContainer = document.getElementById('looking-for-tags-container');
        const lookingForHiddenInput = document.getElementById('looking-for-hidden-input');
        
        // Debug the DOM elements for looking for interests
        console.log('Looking for interests DOM elements:', {
          lookingForInput: lookingForInput,
          lookingForInputExists: !!lookingForInput,
          lookingForDropdown: lookingForDropdown,
          lookingForDropdownExists: !!lookingForDropdown,
          lookingForTagsContainer: lookingForTagsContainer,
          lookingForTagsContainerExists: !!lookingForTagsContainer,
          lookingForHiddenInput: lookingForHiddenInput,
          lookingForHiddenInputExists: !!lookingForHiddenInput
        });
        
        // Check if there are any issues with the HTML structure
        if (!lookingForInput || !lookingForDropdown || !lookingForTagsContainer || !lookingForHiddenInput) {
          console.error('Missing one or more DOM elements for looking for interests!');
          
          // Let's check the HTML structure to see if there are any issues
          const multiSelectContainer = document.getElementById('looking-for-multi-select');
          console.log('Multi-select container HTML:', multiSelectContainer ? multiSelectContainer.outerHTML : 'Not found');
        }

        function updateLookingForHiddenInput() {
          console.log('Updating looking for hidden input with:', Array.from(lookingForSelectedIndustries));
          lookingForHiddenInput.value = JSON.stringify(Array.from(lookingForSelectedIndustries));
        }

        function renderLookingForDropdown() {
          lookingForDropdown.innerHTML = '';
          const inputValue = lookingForInput.value.toLowerCase();
          const filtered = industryOptions.filter(opt => 
            opt.toLowerCase().includes(inputValue) && !lookingForSelectedIndustries.has(opt)
          );

          if (filtered.length > 0 && inputValue) {
            lookingForDropdown.style.display = 'block';
            filtered.forEach(option => {
              const div = document.createElement('div');
              div.className = 'industry-option';
              div.textContent = option;
              div.onclick = () => {
                addLookingForTag(option);
                lookingForInput.value = '';
                renderLookingForDropdown();
                lookingForInput.focus();
              };
              lookingForDropdown.appendChild(div);
            });
          } else {
            lookingForDropdown.style.display = 'none';
          }
        }

        function addLookingForTag(value) {
          if (!value || !value.trim()) {
            console.warn('Attempted to add empty tag value');
            return;
          }
          
          if (!lookingForTagsContainer) {
            console.error('Cannot add tag: lookingForTagsContainer is missing!');
            return;
          }
          
          if (!lookingForInput) {
            console.error('Cannot add tag: lookingForInput is missing!');
            return;
          }
          
          // Don't add duplicates
          if (lookingForSelectedIndustries.has(value)) {
            console.log(`Tag "${value}" already exists, not adding duplicate`);
            return;
          }
          
          console.log('Adding looking for interest tag:', value);
          lookingForSelectedIndustries.add(value);
          
          try {
            // Create and add the tag to the DOM
          const tag = document.createElement('div');
          tag.className = 'industry-tag';
          tag.textContent = value;

          const removeBtn = document.createElement('span');
          removeBtn.textContent = 'Ã';
          removeBtn.className = 'remove-tag';
          removeBtn.onclick = (e) => {
            e.stopPropagation();
            lookingForSelectedIndustries.delete(value);
            updateLookingForHiddenInput();
            lookingForTagsContainer.removeChild(tag);
            renderLookingForDropdown();
          };

          tag.appendChild(removeBtn);
          lookingForTagsContainer.insertBefore(tag, lookingForInput);
            
            // Update hidden input
            updateLookingForHiddenInput();
          } catch (error) {
            console.error('Error adding tag:', error);
          }
        }

        // Function to set initial looking for interests
        function setLookingForInterests(interests) {
          console.log('Setting looking for interests:', interests);
          
          // Basic DOM element checks
          if (!lookingForTagsContainer || !lookingForHiddenInput) {
            console.error('Cannot set looking for interests: Required DOM elements missing');
            return;
          }
          
          // Clear existing data
          lookingForSelectedIndustries.clear();
          
          // Clear existing tags
          const tags = Array.from(lookingForTagsContainer.getElementsByClassName('industry-tag'));
          tags.forEach(tag => tag.remove());
          
          // Safety check - ensure interests is an array
          if (!Array.isArray(interests)) {
            console.error('setLookingForInterests called with non-array:', interests);
            interests = [];
          }
          
          // Add all valid interests as tags
          let addedTags = 0;
          interests.forEach((interest, index) => {
            if (interest && typeof interest === 'string' && interest.trim()) {
              console.log(`Adding looking for interest[${index}]:`, interest);
              try {
                // Add to the Set first
                lookingForSelectedIndustries.add(interest);
                
                // Create the tag element
                const tag = document.createElement('div');
                tag.className = 'industry-tag';
                tag.textContent = interest;
                
                // Create the remove button
                const removeBtn = document.createElement('span');
                removeBtn.textContent = 'Ã';
                removeBtn.className = 'remove-tag';
                removeBtn.onclick = (e) => {
                  e.stopPropagation();
                  lookingForSelectedIndustries.delete(interest);
                  updateLookingForHiddenInput();
                  lookingForTagsContainer.removeChild(tag);
                };
                
                // Add the remove button to the tag
                tag.appendChild(removeBtn);
                
                // Insert the tag before the input
                lookingForTagsContainer.insertBefore(tag, lookingForInput);
                addedTags++;
              } catch (err) {
                console.error(`Error adding tag for "${interest}":`, err);
              }
            }
          });
          
          console.log(`Added ${addedTags} looking for interest tags`);
          
          // Update the hidden input
          updateLookingForHiddenInput();
          
          // Log the final state
          console.log('Looking for interests after setting:', Array.from(lookingForSelectedIndustries));
        }

        // Add event listeners for looking for interests
        if (lookingForInput) {
          lookingForInput.addEventListener('input', () => {
            renderLookingForDropdown();
          });

          lookingForInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ',') {
              e.preventDefault();
              const customValue = lookingForInput.value.trim();
              if (customValue) {
                addLookingForTag(customValue);
                lookingForInput.value = '';
                renderLookingForDropdown();
              }
            } else if (e.key === 'Backspace' && lookingForInput.value === '') {
              const tags = lookingForTagsContainer.getElementsByClassName('industry-tag');
              if (tags.length > 0) {
                const lastTag = tags[tags.length - 1];
                const value = lastTag.textContent.slice(0, -1); // Remove Ã character
                lookingForSelectedIndustries.delete(value);
                updateLookingForHiddenInput();
                lookingForTagsContainer.removeChild(lastTag);
              }
            }
          });
        }

        document.addEventListener('click', (e) => {
          if (!document.getElementById('looking-for-multi-select').contains(e.target)) {
            lookingForDropdown.style.display = 'none';
          }
        });

        // Initialize looking for dropdown
        renderLookingForDropdown();

        // Technical skills options
        const technicalSkillsOptions = [
          "Python", "Java", "JavaScript", "C++", "HTML", "CSS", "SQL", "TypeScript", "Kotlin", "Ruby", "Bash", "MATLAB", "PHP", "Microsoft Excel", "Microsoft Word", "Microsoft PowerPoint", "Adobe Photoshop", "Adobe Illustrator", "Adobe Premiere Pro", "Salesforce", "HubSpot", "Zoho CRM", "Jira", "Trello", "Slack", "Git", "GitHub", "Docker", "Kubernetes", "R", "SPSS", "Tableau", "Power BI", "NumPy", "pandas", "scikit-learn", "TensorFlow", "Keras", "PyTorch", "Excel Pivot Tables", "Google Data Studio", "AWS", "Microsoft Azure", "Google Cloud Platform", "Heroku", "Firebase", "Jenkins", "CircleCI", "GitLab CI", "Ansible", "Terraform", "Agile", "Scrum", "Waterfall", "Kanban", "Confluence", "SEO", "SEM", "Google Analytics", "Facebook Ads Manager", "Content Marketing", "Mailchimp", "Ahrefs", "Moz", "Financial Modeling", "Budgeting", "Forecasting", "QuickBooks", "SAP", "Oracle Financials", "Network Administration", "Cybersecurity", "Wireshark", "Firewalls", "VPN", "Ethical Hacking", "Penetration Testing", "Figma", "Sketch", "Adobe XD", "User Interface Design", "User Experience Design", "Wireframing", "Prototyping", "Video Editing", "Animation", "After Effects", "Final Cut Pro", "Simulation", "Modeling", "COMSOL Multiphysics", "LabVIEW", "APIs", "RESTful Services", "JSON", "XML", "Web Development", "Responsive Design", "Mobile App Development", "Cross-Platform Development", "WordPress", "Drupal", "QA Testing", "Selenium"
        ];
        // Soft skills options
        const softSkillsOptions = [
          "Communication", "Written Communication", "Verbal Communication", "Active Listening", "Public Speaking", "Analytical Skills", "Critical Thinking", "Decision-Making", "Team Leadership", "Management", "Mentoring", "Collaboration", "Interpersonal Skills", "Negotiation", "Flexibility", "Learning Agility", "Change Management", "Time Management", "Planning", "Prioritization", "Client Relations", "Relationship Building", "Conflict Resolution", "Persuasion", "Data Gathering", "Data Analysis", "Data Interpretation", "Innovation", "Creativity", "Empathy", "Building Rapport", "Foreign Language Skills", "Email Correspondence", "Presentation Skills", "Emotional Intelligence", "Stress Management", "Accountability", "Patience", "Cultural Awareness", "Initiative", "Dependability", "Work Ethic", "Attention to Detail", "Open-Mindedness", "Self-Motivation", "Coaching", "Delegation", "Multitasking", "Feedback Reception", "Diplomacy", "Professionalism"
        ];

        // --- Technical Skills Multi-Select ---
        const technicalSkillsSelected = new Set();
        const technicalSkillsInput = document.getElementById('technical-skills-input');
        const technicalSkillsDropdown = document.getElementById('technical-skills-dropdown');
        const technicalSkillsTagsContainer = document.getElementById('technical-skills-tags-container');
        const technicalSkillsHiddenInput = document.getElementById('technical-skills-hidden-input');

        function updateTechnicalSkillsHiddenInput() {
          technicalSkillsHiddenInput.value = JSON.stringify(Array.from(technicalSkillsSelected));
        }
        function renderTechnicalSkillsDropdown() {
          technicalSkillsDropdown.innerHTML = '';
          const inputValue = technicalSkillsInput.value.toLowerCase();
          const filtered = technicalSkillsOptions.filter(opt => 
            opt.toLowerCase().includes(inputValue) && !technicalSkillsSelected.has(opt)
          );
          if (filtered.length > 0 && inputValue) {
            technicalSkillsDropdown.style.display = 'block';
            filtered.forEach(option => {
              const div = document.createElement('div');
              div.className = 'industry-option';
              div.textContent = option;
              div.onclick = () => {
                addTechnicalSkillTag(option);
                technicalSkillsInput.value = '';
                renderTechnicalSkillsDropdown();
                technicalSkillsInput.focus();
              };
              technicalSkillsDropdown.appendChild(div);
            });
          } else {
            technicalSkillsDropdown.style.display = 'none';
          }
        }
        function addTechnicalSkillTag(value) {
          if (!value.trim() || technicalSkillsSelected.has(value)) return;
          technicalSkillsSelected.add(value);
          updateTechnicalSkillsHiddenInput();
          const tag = document.createElement('div');
          tag.className = 'industry-tag';
          tag.textContent = value;
          const removeBtn = document.createElement('span');
          removeBtn.textContent = 'Ã';
          removeBtn.className = 'remove-tag';
          removeBtn.onclick = (e) => {
            e.stopPropagation();
            technicalSkillsSelected.delete(value);
            updateTechnicalSkillsHiddenInput();
            technicalSkillsTagsContainer.removeChild(tag);
            renderTechnicalSkillsDropdown();
          };
          tag.appendChild(removeBtn);
          technicalSkillsTagsContainer.insertBefore(tag, technicalSkillsInput);
        }
        function setTechnicalSkills(skills) {
          technicalSkillsSelected.clear();
          // Clear existing tags
          const tags = Array.from(technicalSkillsTagsContainer.getElementsByClassName('industry-tag'));
          tags.forEach(tag => tag.remove());
          if (Array.isArray(skills)) {
            skills.forEach(skill => {
              if (skill) addTechnicalSkillTag(skill);
            });
          }
          updateTechnicalSkillsHiddenInput();
        }
        if (technicalSkillsInput) {
          technicalSkillsInput.addEventListener('input', renderTechnicalSkillsDropdown);
          technicalSkillsInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ',') {
              e.preventDefault();
              const customValue = technicalSkillsInput.value.trim();
              if (customValue) {
                addTechnicalSkillTag(customValue);
                technicalSkillsInput.value = '';
                renderTechnicalSkillsDropdown();
              }
            } else if (e.key === 'Backspace' && technicalSkillsInput.value === '') {
              const tags = technicalSkillsTagsContainer.getElementsByClassName('industry-tag');
              if (tags.length > 0) {
                const lastTag = tags[tags.length - 1];
                const value = lastTag.textContent.slice(0, -1);
                technicalSkillsSelected.delete(value);
                updateTechnicalSkillsHiddenInput();
                technicalSkillsTagsContainer.removeChild(lastTag);
              }
            }
          });
        }
        document.addEventListener('click', (e) => {
          if (!document.getElementById('technical-skills-multi-select').contains(e.target)) {
            technicalSkillsDropdown.style.display = 'none';
          }
        });
        renderTechnicalSkillsDropdown();

        // --- Soft Skills Multi-Select ---
        const softSkillsSelected = new Set();
        const softSkillsInput = document.getElementById('soft-skills-input');
        const softSkillsDropdown = document.getElementById('soft-skills-dropdown');
        const softSkillsTagsContainer = document.getElementById('soft-skills-tags-container');
        const softSkillsHiddenInput = document.getElementById('soft-skills-hidden-input');
        function updateSoftSkillsHiddenInput() {
          softSkillsHiddenInput.value = JSON.stringify(Array.from(softSkillsSelected));
        }
        function renderSoftSkillsDropdown() {
          softSkillsDropdown.innerHTML = '';
          const inputValue = softSkillsInput.value.toLowerCase();
          const filtered = softSkillsOptions.filter(opt => 
            opt.toLowerCase().includes(inputValue) && !softSkillsSelected.has(opt)
          );
          if (filtered.length > 0 && inputValue) {
            softSkillsDropdown.style.display = 'block';
            filtered.forEach(option => {
              const div = document.createElement('div');
              div.className = 'industry-option';
              div.textContent = option;
              div.onclick = () => {
                addSoftSkillTag(option);
                softSkillsInput.value = '';
                renderSoftSkillsDropdown();
                softSkillsInput.focus();
              };
              softSkillsDropdown.appendChild(div);
            });
          } else {
            softSkillsDropdown.style.display = 'none';
          }
        }
        function addSoftSkillTag(value) {
          if (!value.trim() || softSkillsSelected.has(value)) return;
          softSkillsSelected.add(value);
          updateSoftSkillsHiddenInput();
          const tag = document.createElement('div');
          tag.className = 'industry-tag';
          tag.textContent = value;
          const removeBtn = document.createElement('span');
          removeBtn.textContent = 'Ã';
          removeBtn.className = 'remove-tag';
          removeBtn.onclick = (e) => {
            e.stopPropagation();
            softSkillsSelected.delete(value);
            updateSoftSkillsHiddenInput();
            softSkillsTagsContainer.removeChild(tag);
            renderSoftSkillsDropdown();
          };
          tag.appendChild(removeBtn);
          softSkillsTagsContainer.insertBefore(tag, softSkillsInput);
        }
        function setSoftSkills(skills) {
          softSkillsSelected.clear();
          // Clear existing tags
          const tags = Array.from(softSkillsTagsContainer.getElementsByClassName('industry-tag'));
          tags.forEach(tag => tag.remove());
          if (Array.isArray(skills)) {
            skills.forEach(skill => {
              if (skill) addSoftSkillTag(skill);
            });
          }
          updateSoftSkillsHiddenInput();
        }
        if (softSkillsInput) {
          softSkillsInput.addEventListener('input', renderSoftSkillsDropdown);
          softSkillsInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ',') {
              e.preventDefault();
              const customValue = softSkillsInput.value.trim();
              if (customValue) {
                addSoftSkillTag(customValue);
                softSkillsInput.value = '';
                renderSoftSkillsDropdown();
              }
            } else if (e.key === 'Backspace' && softSkillsInput.value === '') {
              const tags = softSkillsTagsContainer.getElementsByClassName('industry-tag');
              if (tags.length > 0) {
                const lastTag = tags[tags.length - 1];
                const value = lastTag.textContent.slice(0, -1);
                softSkillsSelected.delete(value);
                updateSoftSkillsHiddenInput();
                softSkillsTagsContainer.removeChild(lastTag);
              }
            }
          });
        }
        document.addEventListener('click', (e) => {
          if (!document.getElementById('soft-skills-multi-select').contains(e.target)) {
            softSkillsDropdown.style.display = 'none';
          }
        });
        renderSoftSkillsDropdown();

        // --- Populate edit form with skills if present ---
        const originalPopulateEditForm = populateEditForm;
        populateEditForm = function(data) {
          // Technical skills: check both technical_skills and hardSkills
          if (Array.isArray(data.technical_skills)) {
            setTechnicalSkills(data.technical_skills);
          } else if (Array.isArray(data.hardSkills)) {
            setTechnicalSkills(data.hardSkills);
          }
          // Soft skills: check both soft_skills and softSkills
          if (Array.isArray(data.soft_skills)) {
            setSoftSkills(data.soft_skills);
          } else if (Array.isArray(data.softSkills)) {
            setSoftSkills(data.softSkills);
          }
          originalPopulateEditForm(data);
          const coFoundersValue =
            data.co_founders_looking_for ??
            data.co_founders_count ??
            data.coFoundersCount ??
            '';
          const coFoundersInput = document.getElementById('co-founders-looking-for');
          console.log('Co-founders value for form:', coFoundersValue, 'from data:', {
            co_founders_looking_for: data.co_founders_looking_for,
            co_founders_count: data.co_founders_count,
            coFoundersCount: data.coFoundersCount
          });
          if (coFoundersInput && (typeof coFoundersValue === 'number' || typeof coFoundersValue === 'string')) {
            coFoundersInput.value = coFoundersValue;
            console.log('Set co-founders input value to:', coFoundersInput.value);
          }
        }
      });
    </script>

    <!-- Theme Loader JS -->
    <script src="../js/theme-loader.js"></script>
    <script>
      // Initialize theme when DOM content is loaded
      document.addEventListener('DOMContentLoaded', function() {
        if (typeof initializeTheme === 'function') {
          initializeTheme();
        }
      });
    </script>
    
    <!-- Password Change JS -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const profileChangePasswordForm = document.getElementById('profileChangePasswordForm');
        const profilePasswordError = document.getElementById('profilePasswordError');
        const newPasswordInput = document.getElementById('profileNewPassword');
        const confirmPasswordInput = document.getElementById('profileConfirmPassword');
        const updatePasswordBtn = document.getElementById('updatePasswordBtn');
        const spinner = updatePasswordBtn?.querySelector('.spinner-border');
        const progressBar = document.querySelector('.password-strength .progress-bar');
        
        // Password validation requirements
        const requirements = {
          length: str => str.length >= 8,
          uppercase: str => /[A-Z]/.test(str),
          lowercase: str => /[a-z]/.test(str),
          number: str => /[0-9]/.test(str),
          special: str => /[^A-Za-z0-9]/.test(str)
        };

        // Update password strength in real-time
        if (newPasswordInput && progressBar) {
          newPasswordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            let validRequirements = 0;

            // Check each requirement
            Object.entries(requirements).forEach(([key, validator]) => {
              const requirement = document.querySelector(`[data-requirement="${key}"]`);
              if (!requirement) return; // Skip if element not found
              
              const isValid = validator(password);
              
              if (isValid) {
                requirement.classList.add('valid');
                requirement.classList.remove('invalid');
                requirement.querySelector('i').className = 'ti ti-check text-success';
                validRequirements++;
              } else {
                requirement.classList.add('invalid');
                requirement.classList.remove('valid');
                requirement.querySelector('i').className = 'ti ti-x text-danger';
              }
              
              strength += isValid ? 20 : 0;
            });

            // Update progress bar
            progressBar.style.width = `${strength}%`;
            progressBar.className = `progress-bar bg-${strength <= 40 ? 'danger' : strength <= 80 ? 'warning' : 'success'}`;
          });
        }
        
        // Handle cancel button click - reset form and switch tabs
        const cancelPasswordButton = document.getElementById('cancelPasswordChange');
        if (cancelPasswordButton) {
          cancelPasswordButton.addEventListener('click', function() {
            if (profileChangePasswordForm) {
              profileChangePasswordForm.reset();
              
              // Reset requirements
              document.querySelectorAll('.requirement').forEach(req => {
                if (!req) return; // Skip if element not found
                req.classList.remove('valid', 'invalid');
                const icon = req.querySelector('i');
                if (icon) icon.className = 'ti ti-circle text-muted';
              });
              
              // Reset progress bar
              if (progressBar) {
                progressBar.style.width = '0%';
                progressBar.className = 'progress-bar';
              }
              
              // Switch back to profile tab
              const profileTab = document.getElementById('profile-tab-1');
              if (profileTab) {
                profileTab.click();
              }
            }
          });
        }
        
        if (profileChangePasswordForm) {
          profileChangePasswordForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (profilePasswordError) profilePasswordError.style.display = 'none';
            
            const currentPassword = document.getElementById('profileOldPassword')?.value;
            const newPassword = newPasswordInput?.value;
            const confirmPassword = confirmPasswordInput?.value;
            
            // Reset feedback
            const currentPasswordFeedback = document.getElementById('currentPassword-feedback');
            const confirmPasswordFeedback = document.getElementById('confirmPassword-feedback');
            const oldPasswordInput = document.getElementById('profileOldPassword');
            
            if (currentPasswordFeedback) currentPasswordFeedback.textContent = '';
            if (confirmPasswordFeedback) confirmPasswordFeedback.textContent = '';
            if (oldPasswordInput) oldPasswordInput.classList.remove('is-invalid');
            if (confirmPasswordInput) confirmPasswordInput.classList.remove('is-invalid');
            
            // Validate current password
            if (!currentPassword) {
              if (oldPasswordInput) oldPasswordInput.classList.add('is-invalid');
              if (currentPasswordFeedback) currentPasswordFeedback.textContent = 'Current password is required';
              return;
            }

            // Validate new password
            let isValid = true;
            Object.entries(requirements).forEach(([key, validator]) => {
              if (!validator(newPassword)) {
                isValid = false;
              }
            });

            if (!isValid) {
              showPasswordError('New password does not meet all requirements');
              return;
            }
            
            // Validate password match
            if (newPassword !== confirmPassword) {
              if (confirmPasswordInput) confirmPasswordInput.classList.add('is-invalid');
              if (confirmPasswordFeedback) confirmPasswordFeedback.textContent = 'Passwords do not match';
              return;
            }
            
            // Get authentication token
            const token = localStorage.getItem('token');
            if (!token) {
              showPasswordError('You are not logged in. Please log in and try again.');
              setTimeout(() => {
                window.location.href = '/login.html';
              }, 2000);
              return;
            }
            
            try {
              // Show loading state
              if (updatePasswordBtn) updatePasswordBtn.disabled = true;
              if (spinner) spinner.style.display = 'inline-block';
              
              // Ensure minimum loading time of 2 seconds
              const startTime = Date.now();
              
              // Make API call to change password
              const response = await fetch('/api/profile/change-password', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                  oldPassword: currentPassword,
                  newPassword: newPassword
                })
              });
              
              const data = await response.json();
              
              // Ensure minimum 2 seconds have passed
              const elapsedTime = Date.now() - startTime;
              if (elapsedTime < 2000) {
                await new Promise(resolve => setTimeout(resolve, 2000 - elapsedTime));
              }
              
              if (response.ok) {
                // Success - show toast/alert
                showToast('Password changed successfully!', 'success');
                
                // Reset form
                profileChangePasswordForm.reset();
                
                // Reset requirements
                document.querySelectorAll('.requirement').forEach(req => {
                  if (!req) return; // Skip if element not found
                  req.classList.remove('valid', 'invalid');
                  const icon = req.querySelector('i');
                  if (icon) icon.className = 'ti ti-circle text-muted';
                });
                
                // Reset progress bar
                if (progressBar) {
                  progressBar.style.width = '0%';
                  progressBar.className = 'progress-bar';
                }
                
                // Switch back to profile tab
                const profileTab = document.getElementById('profile-tab-1');
                if (profileTab) {
                  profileTab.click();
                }
              } else {
                if (data.message?.includes('current password')) {
                  if (oldPasswordInput) oldPasswordInput.classList.add('is-invalid');
                  if (currentPasswordFeedback) currentPasswordFeedback.textContent = 'Current password is incorrect';
                }
                showPasswordError(data.message || 'Failed to change password');
              }
            } catch (error) {
              console.error('Error changing password:', error);
              showPasswordError('An error occurred. Please try again.');
            } finally {
              // Reset loading state
              if (updatePasswordBtn) updatePasswordBtn.disabled = false;
              if (spinner) spinner.style.display = 'none';
            }
          });
        }
        
        // Helper function to show error messages
        function showPasswordError(message) {
          if (profilePasswordError) {
            profilePasswordError.textContent = message;
            profilePasswordError.style.display = 'block';
          } else {
            alert(message);
          }
        }
      });

      // Function to toggle password visibility
      function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(inputId + 'Icon');
        
        if (!input || !icon) return;
        
        if (input.type === 'password') {
          input.type = 'text';
          icon.className = 'ti ti-eye-off';
        } else {
          input.type = 'password';
          icon.className = 'ti ti-eye';
        }
      }
    </script>
    
    <!-- Privacy Settings JS -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const privateModeSwitch = document.getElementById('privateMode');
        const updatePrivacyBtn = document.getElementById('updatePrivacyBtn');
        const cancelPrivacyBtn = document.getElementById('cancelPrivacyBtn');
        
        // Original privacy mode state for cancel functionality
         let originalPrivateMode = false;
         
         // Set original private mode value from profile data
         if (typeof window.profileData !== 'undefined' && typeof window.profileData.privateMode !== 'undefined') {
           originalPrivateMode = window.profileData.privateMode;
           if (privateModeSwitch) {
             privateModeSwitch.checked = originalPrivateMode;
           }
         }
         
         // Load private mode setting when the privacy tab is clicked
         document.getElementById('profile-tab-6').addEventListener('click', loadPrivacySettings);
        
        // Load privacy settings from the server
        async function loadPrivacySettings() {
          try {
            const token = localStorage.getItem('token');
            if (!token) {
              console.error('No authentication token found');
              return;
            }
            
            // Update UI to loading state
            if (privateModeSwitch) {
              privateModeSwitch.disabled = true;
            }
            
            const response = await fetch('/api/users/profile/privacy-settings', {
              method: 'GET',
              headers: {
                'Authorization': `Bearer ${token}`
              }
            });
            
            if (!response.ok) {
              const errorData = await response.json().catch(() => ({}));
              console.error('Server error response:', errorData);
              throw new Error(errorData.message || 'Failed to fetch privacy settings');
            }
            
            const data = await response.json();
            console.log('Loaded privacy settings:', data);
            
            // Update the switch state
            if (privateModeSwitch) {
              privateModeSwitch.checked = data.privateMode || false;
              // Store original state for cancel functionality
              originalPrivateMode = data.privateMode || false;
            }
            
          } catch (error) {
            console.error('Error loading privacy settings:', error);
            showToast('Failed to load privacy settings: ' + (error.message || 'Unknown error'), 'error');
            
            // For UI consistency, set it to false on error
            if (privateModeSwitch) {
              privateModeSwitch.checked = false;
              originalPrivateMode = false;
            }
          } finally {
            // Always re-enable the switch
            if (privateModeSwitch) {
              privateModeSwitch.disabled = false;
            }
          }
        }
        
        // Save privacy settings to the server
        async function savePrivacySettings() {
          try {
            const token = localStorage.getItem('token');
            if (!token) {
              showToast('You are not logged in. Please log in and try again.', 'error');
              setTimeout(() => {
                window.location.href = '/login.html';
              }, 2000);
              return;
            }
            
            // Update button to loading state
            updatePrivacyBtn.disabled = true;
            updatePrivacyBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>Updating...';
            
            // Also disable the switch during save
            if (privateModeSwitch) {
              privateModeSwitch.disabled = true;
            }
            
            // Disable the cancel button too
            if (cancelPrivacyBtn) {
              cancelPrivacyBtn.disabled = true;
            }
            
            const privacyValue = privateModeSwitch ? privateModeSwitch.checked : false;
            console.log(`Saving privacy mode: ${privacyValue}`);
            
            const response = await fetch('/api/users/profile/privacy-settings', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
              },
              body: JSON.stringify({
                privateMode: privacyValue
              })
            });
            
            if (!response.ok) {
              const errorData = await response.json().catch(() => ({}));
              console.error('Server error response:', errorData);
              throw new Error(errorData.message || 'Failed to update privacy settings');
            }
            
            const data = await response.json();
            console.log('Privacy settings updated:', data);
            
            // Update original state
            originalPrivateMode = privacyValue;
            
            // Show success message with explanation
            const statusMessage = privacyValue ? 
              'Privacy mode enabled. Your profile won\'t be suggested to other users.' : 
              'Privacy mode disabled. Your profile can be suggested to other users.';
            
            showToast(statusMessage, 'success');
            
            // Switch back to profile tab
            document.getElementById('profile-tab-1').click();
            
          } catch (error) {
            console.error('Error saving privacy settings:', error);
            showToast(error.message || 'Failed to update privacy settings', 'error');
          } finally {
            // Reset button state
            updatePrivacyBtn.disabled = false;
            updatePrivacyBtn.textContent = 'Update Privacy Setting';
            
            // Re-enable the switch
            if (privateModeSwitch) {
              privateModeSwitch.disabled = false;
            }
            
            // Re-enable the cancel button
            if (cancelPrivacyBtn) {
              cancelPrivacyBtn.disabled = false;
            }
          }
        }
        
        // Handle update button click
        if (updatePrivacyBtn) {
          updatePrivacyBtn.addEventListener('click', savePrivacySettings);
        }
        
        // Handle cancel button click
        if (cancelPrivacyBtn) {
          cancelPrivacyBtn.addEventListener('click', function() {
            // Reset to original state
            if (privateModeSwitch) {
              privateModeSwitch.checked = originalPrivateMode;
            }
            
            // Switch back to profile tab
            document.getElementById('profile-tab-1').click();
          });
        }
      });
    </script>
    
    <!-- Notifications Handler JS -->
    <script src="../assets/js/notifications-handler.js"></script>
    <script>
      // Initialize notifications when DOM is fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        console.log('Initializing notifications system on profile page');
        
        // Check if the initNotifications function is available
        if (typeof initNotifications === 'function') {
          // Call the initNotifications function from notifications-handler.js
          initNotifications();
        } else {
          console.warn('initNotifications function not found - notifications may not load properly');
        }
        
        // Force load notifications on page load after a small delay
        setTimeout(function() {
          if (typeof loadNotifications === 'function') {
            console.log('Force loading notifications...');
            loadNotifications(true);
          }
        }, 1000);
      });
    </script>




  </body>
  <!-- [Body] end -->
</html> 

